<div layout="column" class="p20">
    <!-- Site Type -->
    <md-input-container class="exclude-margin" flex>
        <label for="siteType">{{lang.sites_select_site_type}}</label>
        <md-select id="siteType" ng-model="ctrl.selectedSiteType"
                   ng-change="ctrl.onSiteTypeChange($event)"
                   md-on-close="ctrl.clearSearchText('siteType')"
                   data-md-container-class="select-header-container">
            <md-select-header class="select-header">
                <input ng-model="ctrl.siteTypeSearchText"
                       ng-keydown="ctrl.preventSearchKeyDown($event)"
                       placeholder="{{lang.search}}"
                       class="select-header-input">
            </md-select-header>
            <md-option ng-value="null">{{lang.none}}</md-option>
            <md-option ng-value="type"
                       ng-repeat="type in ctrl.correspondenceSiteTypes | translatedNameFilter:ctrl.siteTypeSearchText">
                <span md-highlight-text="ctrl.siteTypeSearchText"
                      md-highlight-flags="i">{{type.getTranslatedName()}}</span>
            </md-option>
        </md-select>
    </md-input-container>
    <!-- Main Sites -->
    <!--<md-input-container class="exclude-margin">
        <label for="mainSite">{{lang.main_site}}</label>
        <md-select id="mainSite" ng-model="ctrl.selectedMainSite"
                   ng-model-options="{trackBy: '$value.id'}"
                   ng-disabled="!ctrl.selectedSiteType || !ctrl.selectedSiteType.id"
                   ng-change="ctrl.getSubSites($event)"
                   md-on-close="ctrl.clearSearchText('mainSite')"
                   data-md-container-class="select-header-container">
            <md-select-header class="select-header" layout="column">
                <div layout="row" flex class="size-100">
                    <input ng-model="ctrl.mainSiteSearchText"
                           ng-keydown="ctrl.preventSearchKeyDown($event, 'mainSite')"
                           placeholder="{{lang.search}}"
                           class="select-header-input">
                    <md-button ng-if="ctrl.mainSiteSearchText"
                               ng-click="ctrl.loadMainSitesRecords($event)"
                               class="select-header-icon md-icon-button"
                               tooltip="{{lang.load_more_records}}">
                        <md-icon md-svg-icon="magnify-plus"></md-icon>
                    </md-button>
                </div>
                <div class="help-text-div" ng-if="ctrl.mainSiteSearchText">{{lang.press_enter_to_load_more_records}}
                </div>
            </md-select-header>
            <md-option ng-repeat="site in ctrl.mainSites | translatedNameFilter: ctrl.mainSiteSearchText"
                       ng-value="site">
                <span md-highlight-text="ctrl.mainSiteSearchText"
                      md-highlight-flags="i">{{site.getTranslatedName()}}</span>
            </md-option>
        </md-select>
    </md-input-container>-->

    <!-- Main Site -->
    <div class="cms-autocomplete-wrapper">
        <span class="button-container">
            <md-button ng-if="ctrl.mainSiteSearchText"
                       ng-click="ctrl.loadMainSitesRecords($event)"
                       class="md-icon-button search-button"
                       tooltip="{{lang.load_more_records}}">
                <md-icon md-svg-icon="magnify-plus"></md-icon>
            </md-button>
        </span>
        <md-autocomplete
                ng-class="{'ac-search-button': ctrl.mainSiteSearchText}"
                ng-disabled="!ctrl.selectedSiteType || !ctrl.selectedSiteType.id"
                md-no-cache="true"
                md-selected-item="ctrl.selectedMainSite"
                md-selected-item-change="ctrl.getSubSites($event)"
                md-search-text="ctrl.mainSiteSearchText"
                md-items="item in ctrl.querySearchMain(ctrl.mainSiteSearchText)"
                md-item-text="item.getTranslatedName()"
                md-min-length="0"
                placeholder="{{lang.main_site}}"
                md-autofocus
                ng-keydown="ctrl.preventSearchKeyDown($event, 'mainSite')">
            <md-item-template>
                <span md-highlight-text="ctrl.mainSiteSearchText"
                      md-highlight-flags="i">{{item.getTranslatedName()}}</span>
            </md-item-template>
            <md-not-found>
                <div layout="column" flex>
                    <div layout="row" flex>
                        <span>{{lang.no_sites_to_display}}</span>
                        <span flex></span>
                        <md-button ng-if="ctrl.mainSiteSearchText"
                                   ng-click="ctrl.loadMainSitesRecords($event)"
                                   class="select-header-icon md-icon-button"
                                   tooltip="{{lang.load_more_records}}">
                            <md-icon md-svg-icon="magnify-plus"></md-icon>
                        </md-button>
                    </div>
                    <div class="help-text-div" ng-if="ctrl.mainSiteSearchText">
                        {{lang.press_enter_to_load_more_records}}
                    </div>
                </div>
            </md-not-found>
        </md-autocomplete>
    </div>
    <br/>
    <!-- Sub Sites -->
    <md-autocomplete
            ng-disabled="!ctrl.selectedMainSite || ctrl.selectedItem"
            md-no-cache="true"
            md-selected-item="ctrl.selectedItem"
            md-selected-item-change="ctrl.changeSubCorrespondence(ctrl.selectedItem)"
            md-search-text="ctrl.searchText"
            md-items="item in ctrl.querySearch(ctrl.searchText)"
            md-item-text="item.getTranslatedName()"
            md-min-length="0"
            placeholder="{{lang.sub_site}}"
            md-autofocus>
        <md-item-template>
            <span md-highlight-text="ctrl.searchText" md-highlight-flags="i">{{item.getTranslatedName()}}</span>
            <!-- - {{ item.getTranslatedName(true)}}-->
        </md-item-template>
        <md-not-found>
            {{lang.no_sites_to_display}}
        </md-not-found>
    </md-autocomplete>
</div>
