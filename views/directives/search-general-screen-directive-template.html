<div id="general-search-form">
    <accordion-directive label-collapse="ctrl.labelCollapse"
                         validation="false">
        <accordion-item active>
            <accordion-title>
                <div layout="row" layout-align="start center">
                    <md-icon md-svg-icon="magnify"></md-icon>
                    <span> {{lang.simple_search}}</span>
                    <span flex></span>
                </div>
            </accordion-title>
            <accordion-content>
                <ng-form ng-enter="ctrl.searchCorrespondence()" name="simpleSearchForm">
                    <div ng-if="ctrl.checkFieldStatus('docSubject')" layout="row">
                        <div flex layout="row">
                            <md-input-container flex>
                                <label for="docSubjectGeneral">{{lang.document_subject}}</label>
                                <input id="docSubjectGeneral" name="docSubject"
                                       ng-model="ctrl.searchCriteria.docSubject"/>
                            </md-input-container>
                        </div>
                    </div> <!-- First row -->
                    <div layout="row">
                        <div ng-if="ctrl.checkFieldStatus('docSerial')" flex layout="row">
                            <md-input-container class="restrict-max" flex>
                                <label for="serialNoFromGeneral">{{lang.search_module_serial_from}}</label>
                                <input id="serialNoFromGeneral" name="serialNoFrom"
                                       ng-model="ctrl.searchCriteria.serialNoFrom"
                                       min="1" max="ctrl.getMinMaxSerialNumberValues('from', 'max').value"
                                       custom-validate-directive="number" type="text"
                                       min-max-number-directive>
                                <div ng-messages="simpleSearchForm.serialNoFrom.$error">
                                    <div ng-message="number">{{lang.numberonly}}</div>
                                    <div ng-message="min">{{lang.min_number.change({number:
                                        ctrl.getMinMaxSerialNumberValues('from',
                                        'min').errorValue})}}
                                    </div>
                                    <div ng-message="max">{{lang.max_number.change({number:
                                        ctrl.getMinMaxSerialNumberValues('from',
                                        'max').errorValue})}}
                                    </div>
                                </div>
                            </md-input-container>
                        </div><!-- serialNoFrom -->
                        <div ng-if="ctrl.checkFieldStatus('docSerial')" flex layout="row">
                            <md-input-container class="restrict-max" flex>
                                <label>{{lang.search_module_serial_to}}</label>
                                <input id="serialNoToGeneral" name="serialNoTo"
                                       ng-model="ctrl.searchCriteria.serialNoTo"
                                       custom-validate-directive="number" type="text"
                                       min="ctrl.getMinMaxSerialNumberValues('to', 'min').value"
                                       min-max-number-directive>
                                <div ng-messages="simpleSearchForm.serialNoTo.$error">
                                    <div ng-message="number">{{lang.numberonly}}</div>
                                    <div ng-message="min">{{lang.min_number.change({number:
                                        ctrl.getMinMaxSerialNumberValues('to',
                                        'min').errorValue})}}
                                    </div>
                                </div>
                            </md-input-container>
                        </div><!-- serialNoTo -->
                        <div ng-if="ctrl.checkFieldStatus('registryOU')" flex layout="row">
                            <md-input-container flex>
                                <label for="registryOU">{{lang.select_organization}}</label>
                                <md-select data-md-container-class="select-header-container sticky-search-bar"
                                           id="registryOU"
                                           name="registryOU"
                                           md-on-close="ctrl.registryOUSearchText = ''"
                                           ng-change="ctrl.onRegistrySelectedChange()"
                                           ng-model="ctrl.searchCriteria.registryOU">
                                    <md-select-header class="select-header" layout="column">
                                        <div layout="row" flex class="size-100">
                                            <input ng-model="ctrl.registryOUSearchText"
                                                   type="search"
                                                   ng-keydown="$event.stopPropagation()"
                                                   placeholder="{{lang.search}}"
                                                   class="select-header-input">
                                        </div>
                                    </md-select-header>
                                    <md-option ng-if="!ctrl.registryOUSearchText.length" ng-value="null">{{lang.none}}
                                    </md-option>
                                    <md-option
                                            md-highlight-text="ctrl.registryOUSearchText" md-highlight-flags="i"
                                            ng-value="organization.id"
                                            ng-repeat="organization in ctrl.registryOrganizations|translatedNameFilter:ctrl.registryOUSearchText">
                                        {{organization.getTranslatedName()}}
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </div>
                        <div ng-if="ctrl.checkFieldStatus('ou')" flex layout="row">
                            <md-input-container flex>
                                <label for="ou">{{lang.department}}</label>
                                <md-select data-md-container-class="select-header-container sticky-search-bar"
                                           id="ou"
                                           name="ou"
                                           md-on-close="ctrl.ouSearchText = ''"
                                           ng-model="ctrl.searchCriteria.ou">
                                    <md-select-header class="select-header" layout="column">
                                        <div layout="row" flex class="size-100">
                                            <input ng-model="ctrl.ouSearchText"
                                                   type="search"
                                                   ng-keydown="$event.stopPropagation()"
                                                   placeholder="{{lang.search}}"
                                                   class="select-header-input">
                                        </div>
                                    </md-select-header>
                                    <md-option ng-if="!ctrl.ouSearchText.length" ng-value="null">{{lang.none}}
                                    </md-option>
                                    <md-option
                                            md-highlight-text="ctrl.ouSearchText" md-highlight-flags="i"
                                            ng-value="organization.id"
                                            ng-repeat="organization in ctrl.organizations|translatedNameFilter:ctrl.ouSearchText">
                                        {{organization.getTranslatedName()}}
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </div>
                        <!-- directive: generate-remaining-search-div-directive -->
                    </div> <!-- Second row -->
                    <div layout="row">
                        <div ng-if="ctrl.checkFieldStatus('securityLevel')" flex layout="row">
                            <md-input-container flex>
                                <label for="securityLevel">{{lang.security_level}}</label>
                                <md-select name="securityLevel" id="securityLevel"
                                           ng-model="ctrl.searchCriteria.securityLevel">
                                    <md-option ng-value="null">{{lang.all}}</md-option>
                                    <md-option ng-value="security"
                                               ng-repeat="security in ctrl.securityLevels">
                                        {{security.getTranslatedName()}}
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </div>
                        <div ng-if="ctrl.checkFieldStatus('docDate')" flex layout="row">
                            <md-input-container flex="">
                                <label for="year">{{lang.search_module_year}}</label>
                                <md-select data-md-container-class="select-header-container sticky-search-bar"
                                           id="year"
                                           name="year"
                                           ng-change="ctrl.onYearChanged($event)"
                                           md-on-close="ctrl.yearSearchText = ''"
                                           ng-model="ctrl.searchCriteria.year">
                                    <md-select-header class="select-header" layout="column">
                                        <div layout="row" flex class="size-100">
                                            <input ng-model="ctrl.yearSearchText"
                                                   type="search"
                                                   ng-keydown="ctrl.allowPropagationUpDownArrows($event)"
                                                   placeholder="{{lang.search}}"
                                                   class="select-header-input">
                                        </div>
                                    </md-select-header>
                                    <md-option ng-value="'All'">{{lang.all}}</md-option>
                                    <md-option
                                            ng-value="year"
                                            ng-repeat="year in ctrl.years|filter:ctrl.yearSearchText">
                                        {{year}}
                                    </md-option>
                                </md-select>
                                <md-button class="md-icon-button cms-select-overlay-button"
                                           tooltip="{{lang.change_date_range}}"
                                           ng-click="ctrl.changeYearRange($event)">
                                    <md-icon md-svg-icon="calendar-today"></md-icon>
                                </md-button>
                            </md-input-container>
                        </div>
                        <div ng-if="ctrl.checkFieldStatus('docDate')" flex layout="row">
                            <md-input-container class="cms-datepicker md-block" flex>
                                <label>{{lang.search_module_start_date}}</label>
                                <input readonly disabled value="{{ctrl.searchCriteria.docDateFrom}}"/>
                            </md-input-container>
                        </div>
                        <div ng-if="ctrl.checkFieldStatus('docDate')" flex layout="row">
                            <md-input-container class="cms-datepicker md-block"
                                                flex>
                                <label>{{lang.search_module_end_date}}</label>
                                <input readonly disabled value="{{ctrl.searchCriteria.docDateTo}}"/>
                            </md-input-container>
                        </div>
                        <!-- directive: generate-remaining-search-div-directive -->
                    </div>
                    <div layout="row">
                        <div ng-if="ctrl.checkFieldStatus('priorityLevel')" flex layout="row">
                            <md-input-container flex>
                                <label>{{lang.outgoing_priority_level}}</label>
                                <md-select ng-model="ctrl.searchCriteria.priorityLevel">
                                    <md-option ng-value="null">{{lang.all}}</md-option>
                                    <md-option ng-value="priority" ng-repeat="priority in ctrl.priorityLevels">
                                        {{priority.getTranslatedName()}}
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </div>
                        <div ng-if="ctrl.checkFieldStatus('docFullSerial')" flex layout="row">
                            <md-input-container class="restrict-max" flex>
                                <label>{{lang.search_module_serial}}</label>
                                <input type="text" ng-model="ctrl.searchCriteria.docFullSerial">
                            </md-input-container>
                        </div>
                        <div flex layout="row"></div>
                        <div flex layout="row"></div>
                        <!-- directive: generate-remaining-search-div-directive -->
                    </div> <!-- Fourth row -->
                    <div layout="row">
                        <md-button ng-click="ctrl.searchCorrespondence()" id="simple-search-button"
                                   class="md-raised md-primary search-button">
                            {{lang.search}}
                        </md-button>
                        <md-button ng-click="ctrl.cleanSearchCriteriaForms()"
                                   class="md-raised search-button">
                            {{lang.search_module_reset_filters}}
                        </md-button>
                        <span flex></span>
                    </div> <!-- Fifth row -->
                </ng-form>
            </accordion-content>
        </accordion-item>
        <accordion-item>
            <accordion-title>
                <div layout="row" layout-align="start center">
                    <md-icon md-svg-icon="database-search"></md-icon>
                    <span> {{lang.advanced_search}}</span>
                    <span flex></span>
                </div>
            </accordion-title>
            <accordion-content>
                <ng-form ng-enter="ctrl.searchCorrespondence()" name="advancedSearchForm">
                    <div layout="row">
                        <div ng-if="ctrl.checkFieldStatus('mainClassification')" flex layout="row">
                            <md-input-container flex="">
                                <label for="mainClassification">{{lang.outgoing_main_classification}}</label>
                                <md-select data-md-container-class="select-header-container sticky-search-bar"
                                           id="mainClassification"
                                           name="mainClassification"
                                           ng-change="ctrl.onMainClassificationChanged()"
                                           md-on-close="ctrl.mainClassificationSearchText = ''"
                                           ng-model="ctrl.searchCriteria.mainClassification">
                                    <md-select-header class="select-header" layout="column">
                                        <div layout="row" flex class="size-100">
                                            <input ng-model="ctrl.mainClassificationSearchText"
                                                   autocomplete="off"
                                                   type="text"
                                                   ng-keyup="ctrl.setPropertiesSpaceBackIfNoLength($event , ctrl.mainClassificationSearchText ,ctrl.setOldMainClassification)"
                                                   ng-keydown="ctrl.allowPropagationUpDownArrows($event,ctrl.loadMainClassificationByCriteria)"
                                                   placeholder="{{lang.search}}"
                                                   class="select-header-input">
                                            <md-button
                                                    ng-click="ctrl.loadMainClassificationByCriteria($event)"
                                                    tooltip="{{lang.load_more_records}}" class="md-icon-button">
                                                <md-icon md-svg-icon="magnify-plus"></md-icon>
                                            </md-button>
                                        </div>
                                    </md-select-header>
                                    <md-option ng-if="!ctrl.mainClassificationSearchText.length" ng-value="null">
                                        {{lang.none}}
                                    </md-option>
                                    <md-option md-highlight-text="ctrl.mainClassificationSearchText"
                                               md-highlight-flags="i"
                                               ng-value="mainClassification.classification"
                                               ng-repeat="mainClassification in ctrl.mainClassifications|translatedNameFilter:ctrl.mainClassificationSearchText:'getIdNameByLanguage':'classification'">
                                        {{mainClassification.classification.getIdNameByLanguage()}}
                                    </md-option>
                                    <md-option
                                            ng-click="ctrl.loadMainClassificationByCriteria(ctrl.mainClassificationSearchText , $event)"
                                            ng-if="!(ctrl.mainClassifications|translatedNameFilter:ctrl.mainClassificationSearchText:'getIdNameByLanguage':'classification').length && ctrl.mainClassificationSearchText.length">
                                        <span class="red-text">{{lang.press_enter_to_load_more_records}}</span>
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </div>
                        <div ng-if="ctrl.checkFieldStatus('subClassification')" flex layout="row">
                            <md-input-container flex="">
                                <label for="subClassification">{{lang.outgoing_sub_classification}}</label>
                                <md-select data-md-container-class="select-header-container sticky-search-bar"
                                           id="subClassification"
                                           name="subClassification"
                                           md-on-close="ctrl.subClassificationSearchText = ''"
                                           ng-model="ctrl.searchCriteria.subClassification">
                                    <md-select-header class="select-header" layout="column">
                                        <div layout="row" flex class="size-100">
                                            <input ng-model="ctrl.subClassificationSearchText"
                                                   autocomplete="off"
                                                   type="text"
                                                   ng-keyup="ctrl.setPropertiesSpaceBackIfNoLength($event , ctrl.subClassificationSearchText ,ctrl.setOldSubClassification)"
                                                   ng-keydown="ctrl.allowPropagationUpDownArrows($event,ctrl.loadSubClassificationByCriteria)"
                                                   placeholder="{{lang.search}}"
                                                   class="select-header-input">
                                            <md-button
                                                    ng-click="ctrl.loadSubClassificationByCriteria($event)"
                                                    tooltip="{{lang.load_more_records}}" class="md-icon-button">
                                                <md-icon md-svg-icon="magnify-plus"></md-icon>
                                            </md-button>
                                        </div>
                                    </md-select-header>
                                    <md-option ng-if="!ctrl.subClassificationSearchText.length" ng-value="null">
                                        {{lang.none}}
                                    </md-option>
                                    <md-option md-highlight-text="ctrl.subClassificationSearchText"
                                               md-highlight-flags="i"
                                               ng-value="subClassification"
                                               ng-repeat="subClassification in ctrl.subClassifications|translatedNameFilter:ctrl.subClassificationSearchText">
                                        {{subClassification.getIdNameByLanguage()}}
                                    </md-option>
                                    <md-option
                                            ng-click="ctrl.loadSubClassificationByCriteria(ctrl.subClassificationSearchText , $event)"
                                            ng-if="!(ctrl.subClassifications|translatedNameFilter:ctrl.subClassificationSearchText).length && ctrl.subClassificationSearchText.length">
                                        <span class="red-text">{{lang.press_enter_to_load_more_records}}</span>
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </div>
                        <div ng-if="ctrl.checkFieldStatus('linkedEntities')" flex layout="row">
                            <md-input-container flex>
                                <label for="selectedEntityType">{{lang.linked_entity}}</label>
                                <md-select id="selectedEntityType"
                                           ng-change="ctrl.openEntityTypePopup(true)"
                                           name="selectedEntityType"
                                           ng-model="ctrl.searchCriteria.selectedEntityType">
                                    <md-option ng-value="null">{{lang.none}}</md-option>
                                    <md-option ng-value="type" ng-repeat="type in ctrl.entityTypes">
                                        {{type.getTranslatedName()}}
                                    </md-option>
                                </md-select>
                                <!-- edit selected linked type  -->
                                <md-button ng-click="ctrl.openEntityTypePopup(false)"
                                           class="md-icon-button cms-select-overlay-button"
                                           tooltip-direction="{{lang.current === 'en' ? 'left' : 'right'}}"
                                           tooltip="{{lang.edit}}">
                                    <md-icon md-svg-icon="pencil"></md-icon>
                                </md-button>
                            </md-input-container>
                        </div>
                        <div ng-if="ctrl.checkFieldStatus('linkedEntities')" flex layout="row">
                            <md-input-container class="restrict-max" flex>
                                <label>{{lang.selected_entity_name}}</label>
                                <input type="text" value="{{ctrl.searchCriteria.linkedEntities.getName()}}" disabled>
                            </md-input-container>
                        </div>
                        <!-- directive: generate-remaining-search-div-directive -->
                    </div><!-- Sixth row -->
                    <div layout="row">
                        <div ng-if="ctrl.checkFieldStatus('docType')" flex layout="row">
                            <md-input-container  flex="">
                                <label for="docType">{{lang.outgoing_document_type}}</label>
                                <md-select data-md-container-class="select-header-container sticky-search-bar"
                                           id="docType"
                                           name="docType"
                                           md-on-close="ctrl.docTypeSearchText = ''"
                                           ng-model="ctrl.searchCriteria.docType">
                                    <md-select-header class="select-header" layout="column">
                                        <div layout="row" flex class="size-100">
                                            <input ng-model="ctrl.docTypeSearchText"
                                                   type="search"
                                                   ng-keydown="ctrl.allowPropagationUpDownArrows($event)"
                                                   placeholder="{{lang.search}}"
                                                   class="select-header-input">
                                        </div>
                                    </md-select-header>
                                    <md-option ng-if="!ctrl.docTypeSearchText.length" ng-value="null">{{lang.none}}
                                    </md-option>
                                    <md-option
                                            md-highlight-text="ctrl.docTypeSearchText" md-highlight-flags="i"
                                            ng-value="type.lookupKey"
                                            ng-repeat="type in ctrl.docTypes|translatedNameFilter:ctrl.docTypeSearchText">
                                        {{type.getTranslatedName()}}
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </div>
                        <div ng-if="ctrl.checkFieldStatus('fileId')" flex layout="row">
                            <md-input-container  flex="">
                                <label for="documentFile">{{lang.outgoing_file}}</label>
                                <md-select data-md-container-class="select-header-container sticky-search-bar"
                                           id="documentFile"
                                           name="documentFile"
                                           ng-change="ctrl.onFileChanged(ctrl.searchCriteria.fileId)"
                                           md-on-close="ctrl.documentFileSearchText = ''"
                                           ng-model="ctrl.searchCriteria.fileId">
                                    <md-select-header class="select-header" layout="column">
                                        <div layout="row" flex class="size-100">
                                            <input ng-model="ctrl.documentFileSearchText"
                                                   type="text"
                                                   ng-keyup="ctrl.setPropertiesSpaceBackIfNoLength($event , ctrl.documentFileSearchText ,ctrl.setOldDocumentFiles)"
                                                   ng-keydown="ctrl.allowPropagationUpDownArrows($event,ctrl.loadDocumentFilesByCriteria)"
                                                   placeholder="{{lang.search}}"
                                                   class="select-header-input">
                                            <md-button
                                                    ng-click="ctrl.loadDocumentFilesByCriteria( $event)"
                                                    tooltip="{{lang.load_more_records}}" class="md-icon-button">
                                                <md-icon md-svg-icon="magnify-plus"></md-icon>
                                            </md-button>
                                        </div>
                                    </md-select-header>
                                    <md-option ng-if="!ctrl.documentFileSearchText.length" ng-value="null">{{lang.none}}
                                    </md-option>
                                    <md-option md-highlight-text="ctrl.documentFileSearchText" md-highlight-flags="i"
                                               ng-value="file.file"
                                               ng-repeat="file in ctrl.documentFiles|translatedNameFilter:ctrl.documentFileSearchText:null:'file'">
                                        {{file.file.getTranslatedName()}}
                                    </md-option>
                                    <md-option
                                            ng-click="ctrl.loadDocumentFilesByCriteria(ctrl.documentFileSearchText , $event)"
                                            ng-if="!(ctrl.documentFiles|translatedNameFilter:ctrl.documentFileSearchText:null:'file').length && ctrl.documentFileSearchText.length">
                                        <span class="red-text">{{lang.press_enter_to_load_more_records}}</span>
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </div>
                        <div ng-if="ctrl.checkFieldStatus('fileCode')" flex layout="row">
                            <md-input-container  class="restrict-max" flex>
                                <label for="fileCodeGeneral">{{lang.outgoing_file_code}}</label>
                                <input name="fileCode"
                                       id="fileCodeGeneral" ng-enter="ctrl.onFileCodeChanged()"
                                       ng-model="ctrl.searchCriteria.fileCode"
                                       type="text">
                            </md-input-container>
                        </div>
                        <div ng-if="ctrl.checkFieldStatus('fileSerial')"  flex layout="row">
                            <md-input-container class="restrict-max" flex>
                                <label for="fileSerialGeneral">{{lang.outgoing_file_serial}}</label>
                                <input name="fileSerial" custom-validate-directive="number"
                                       id="fileSerialGeneral"
                                       ng-model="ctrl.searchCriteria.fileSerial">
                                <div ng-messages="advancedSearchForm.fileSerial.$error">
                                    <div ng-message="number">{{lang.numberonly}}</div>
                                </div>
                            </md-input-container>
                        </div>
                        <!-- directive: generate-remaining-search-div-directive -->
                    </div><!-- Seventh row -->
                    <div ng-if="ctrl.checkFieldStatus('docNotes')" layout="row">
                        <div flex layout="row">
                            <md-input-container flex>
                                <label>{{lang.properties_notes}}</label>
                                <textarea class="cms-default" ng-model="ctrl.searchCriteria.docNotes"
                                          rows="5"></textarea>
                            </md-input-container>
                        </div>
                    </div><!-- Twelfth row -->
                    <div layout="row">
                        <md-button ng-click="ctrl.searchCorrespondence()" id="advanced-search-button"
                                   class="md-raised md-primary search-button">
                            {{lang.search}}
                        </md-button>
                        <md-button ng-click="ctrl.cleanSearchCriteriaForms()"
                                   class="md-raised search-button">
                            {{lang.search_module_reset_filters}}
                        </md-button>
                        <span flex></span>
                    </div><!-- Thirteen row -->
                </ng-form>
            </accordion-content>
        </accordion-item>
    </accordion-directive>
</div>
