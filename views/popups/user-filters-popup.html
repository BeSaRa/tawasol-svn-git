<md-dialog class="dialog-extend cms-tabs-dialog" layout="column"
           ng-class="{'cms-dialog-full-screen':ctrl.fullScreen}">
    <popup-toolbar-directive ng-if="!ctrl.editMode"
                             header-text="{{ lang.create_filter }}"></popup-toolbar-directive>
    <popup-toolbar-directive ng-if="ctrl.editMode"
                             header-text="{{ ctrl.model.getNames() }}"></popup-toolbar-directive>
    <md-dialog-content scroll-directive flex>
        <div>
            <form name="userFilter" autocomplete="off">
                <md-tabs md-dynamic-height>
                    <md-tab label="{{lang.basic_info}}">
                        <md-content class="md-padding">
                            <div layout="column">
                                <div layout="row">
                                    <!-- Arabic Name-->
                                    <md-input-container flex>
                                        <label for="arName">{{lang.arabic_name}}</label>
                                        <input name="arName" id="arName" ng-required="!ctrl.filter.enName" minlength="1"
                                               ng-model="ctrl.filter.arName">
                                        <div ng-messages="userFilter.arName.$error">
                                            <div ng-message="required">{{lang.field_required}}</div>
                                            <div ng-message="minlength">{{lang.short}}</div>
                                            <div ng-message="maxlength">{{lang.max_length.change({length:10})}}</div>
                                        </div>
                                    </md-input-container>
                                    <!-- English Name -->
                                    <md-input-container flex>
                                        <label for="enName">{{lang.english_name}}</label>
                                        <input name="enName" id="enName" ng-required="!ctrl.filter.arName" minlength="1"
                                               ng-model="ctrl.filter.enName">
                                        <div ng-messages="userFilter.enName.$error">
                                            <div ng-message="required">{{lang.field_required}}</div>
                                            <div ng-message="minlength">{{lang.short}}</div>
                                            <div ng-message="maxlength">{{lang.max_length.change({length:10})}}</div>
                                        </div>
                                    </md-input-container>
                                </div>
                                <div layout="row">
                                    <!-- Item order -->
                                    <md-input-container flex>
                                        <label for="sortOptionId">{{lang.item_order}}</label>
                                        <input name="sortOptionId" id="sortOptionId" required
                                               ng-model="ctrl.filter.sortOptionId" min="0"
                                               min-max-number-directive
                                               maxlength="5" custom-validate-directive="number">
                                        <div ng-messages="userFilter.sortOptionId.$error">
                                            <div ng-message="required">{{lang.field_required}}</div>
                                            <div ng-message="maxlength">{{lang.max_length.change({length:5})}}</div>
                                            <div ng-message="min">{{lang.min_number.change({number:0})}}</div>
                                            <div ng-message="number">{{lang.numberonly}}</div>
                                        </div>
                                    </md-input-container>
                                    <!-- Status -->
                                    <div flex class="p20">
                                        <md-switch ng-model="ctrl.filter.status">
                                            <label>{{lang.status}} : {{ctrl.filter.getTranslatedStatus()}}</label>
                                        </md-switch>
                                    </div>
                                </div>
                            </div>
                        </md-content>
                    </md-tab>
                    <md-tab label="{{lang.search_criteria}}">
                        <md-content class="md-padding">
                            <div layout="column">
                                <div layout="row">
                                    <!-- Document Type -->
                                    <md-input-container flex>
                                        <label for="docType">{{ctrl.lookupNames['key_2'].getTranslatedName()}}</label>
                                        <md-select name="docType" id="docType"
                                                   ng-change="ctrl.onChangeDocumentType($event)"
                                                   ng-model="ctrl.filter.ui.key_2.value">
                                            <md-option ng-value="null">{{lang.none}}</md-option>
                                            <md-option ng-value="docType.lookupKey"
                                                       ng-repeat="docType in ctrl.documentTypes">
                                                {{docType.getTranslatedName()}}
                                            </md-option>
                                        </md-select>
                                    </md-input-container>
                                    <!-- Document Subject -->
                                    <md-input-container flex>
                                        <label for="docSubject">{{ctrl.lookupNames['key_3'].getTranslatedName()}}</label>
                                        <input id="docSubject" name="docSubject" ng-model="ctrl.filter.ui.key_3.value">
                                    </md-input-container>
                                </div>
                                <div layout="row">
                                    <!-- Security Level -->
                                    <md-input-container flex>
                                        <label for="securityLevel">{{ctrl.lookupNames['key_14'].getTranslatedName()}}</label>
                                        <md-select name="securityLevel" id="securityLevel"
                                                   ng-model="ctrl.filter.ui.key_14.value">
                                            <md-option ng-value="null">{{lang.none}}</md-option>
                                            <md-option ng-value="securityLevel.lookupKey"
                                                       ng-repeat="securityLevel in ctrl.securityLevels">
                                                {{securityLevel.getTranslatedName()}}
                                            </md-option>
                                        </md-select>
                                    </md-input-container>
                                    <!-- Priority Level -->
                                    <md-input-container flex>
                                        <label for="priorityLevel">{{ctrl.lookupNames['key_15'].getTranslatedName()}}</label>
                                        <md-select name="priorityLevel" id="priorityLevel"
                                                   ng-model="ctrl.filter.ui.key_15.value">
                                            <md-option ng-value="null">{{lang.none}}</md-option>
                                            <md-option ng-value="priorityLevel.lookupKey"
                                                       ng-repeat="priorityLevel in ctrl.priorityLevels">
                                                {{priorityLevel.getTranslatedName()}}
                                            </md-option>
                                        </md-select>
                                    </md-input-container>
                                </div>
                                <div layout="row">
                                    <!-- Sender -->
                                    <md-input-container flex>
                                        <label for="sender">{{ctrl.lookupNames['key_9'].getTranslatedName()}}</label>
                                        <md-select name="sender" id="sender"
                                                   ng-model="ctrl.filter.ui.key_9.value"
                                                   md-on-close="ctrl.clearSearchText('sender')"
                                                   data-md-container-class="select-header-container">
                                            <md-select-header class="select-header">
                                                <input ng-model="ctrl.senderSearchText"
                                                       ng-keydown="ctrl.handleSearchKeyDown($event, 'sender')"
                                                       placeholder="{{lang.search}}"
                                                       class="select-header-input">
                                            </md-select-header>
                                            <md-option ng-value="null">{{lang.none}}</md-option>
                                            <md-option ng-value="sender.domainName"
                                                       ng-repeat="sender in ctrl.senders | translatedNameFilter: ctrl.senderSearchText">
                                                  <span md-highlight-text="ctrl.senderSearchText"
                                                        md-highlight-flags="i">{{sender.getTranslatedName()}}</span>
                                            </md-option>
                                        </md-select>
                                    </md-input-container>
                                    <!-- Action -->
                                    <md-input-container flex>
                                        <label for="action">{{ctrl.lookupNames['key_7'].getTranslatedName()}}</label>
                                        <md-select name="action" id="action"
                                                   ng-model="ctrl.filter.ui.key_7.value"
                                                   md-on-close="ctrl.clearSearchText('action')"
                                                   data-md-container-class="select-header-container">
                                            <md-select-header class="select-header">
                                                <input ng-model="ctrl.actionSearchText"
                                                       ng-keydown="ctrl.handleSearchKeyDown($event, 'action')"
                                                       placeholder="{{lang.search}}"
                                                       class="select-header-input"/>
                                            </md-select-header>
                                            <md-option ng-value="null">{{lang.none}}</md-option>
                                            <md-option ng-value="action.id"
                                                       ng-repeat="action in ctrl.actions  | translatedNameFilter: ctrl.actionSearchText">
                                              <span md-highlight-text="ctrl.actionSearchText"
                                                    md-highlight-flags="i">
                                                {{action.getTranslatedName()}}</span>
                                            </md-option>
                                        </md-select>
                                    </md-input-container>
                                </div>
                                <!-- Received Date -->
                                <div layout="row">
                                    <md-input-container flex>
                                        <label for="action">{{lang.user_inbox_filter_received_date}}</label>
                                        <md-select ng-model="ctrl.filter.selectedReceivedDateFilterType"
                                                   ng-change="ctrl.resetReceivedDateType($event)">
                                            <md-option ng-value="null">{{lang.none}}</md-option>
                                            <md-option ng-repeat="action in ctrl.receivedDateFilterTypes"
                                                       ng-value="action.id">
                                                {{action.getTranslatedName()}}
                                            </md-option>
                                        </md-select>
                                    </md-input-container>
                                    <!-- Received Date Greater Than -->
                                    <md-input-container ng-if="ctrl.filter.selectedReceivedDateFilterType === 4" flex class="cms-datepicker">
                                        <label for="key_4">{{lang.date}}</label>
                                        <md-datepicker id="key_4" ng-model="ctrl.filter.ui.key_4.value"
                                                       md-open-on-focus></md-datepicker>
                                    </md-input-container>
                                    <!-- Received Date Less Than -->
                                    <md-input-container ng-if="ctrl.filter.selectedReceivedDateFilterType === 6" flex class="cms-datepicker">
                                        <label for="key_6">{{lang.date}}</label>
                                        <md-datepicker id="key_6" ng-model="ctrl.filter.ui.key_6.value"
                                                       md-open-on-focus></md-datepicker>
                                    </md-input-container>
                                </div>
                                <!-- Received Date Between -->
                                <fieldset layout="column" class="search-fieldset"
                                          ng-if="ctrl.filter.selectedReceivedDateFilterType === 11">
                                    <legend class="md-accent">{{ctrl.lookupNames['key_11'].getTranslatedName()}}
                                    </legend>
                                    <div layout="row">
                                        <!-- Received Date From -->
                                        <md-input-container flex class="cms-datepicker">
                                            <label for="key_11_1">{{lang.user_inbox_filter_from}}</label>
                                            <md-datepicker id="key_11_1" ng-model="ctrl.filter.ui.key_11.value1"
                                                           name="receivedDateStart" md-open-on-focus
                                                           ng-change="ctrl.getMinReceivedEndDate($event)"
                                                           md-max-date="ctrl.calculatedMaxReceivedStartDate"
                                                           ng-required="ctrl.filter.ui.key_11.value2"></md-datepicker>
                                            <div ng-messages="userFilter.receivedDateStart.$error">
                                                <div ng-message="required">{{lang.field_required}}</div>
                                            </div>
                                        </md-input-container>
                                        <!-- Received Date To -->
                                        <md-input-container flex class="cms-datepicker">
                                            <label for="key_11_2">{{lang.user_inbox_filter_to}}</label>
                                            <md-datepicker id="key_11_2" ng-model="ctrl.filter.ui.key_11.value2"
                                                           name="receivedDateEnd" md-open-on-focus
                                                           ng-change="ctrl.getMaxReceivedStartDate($event)"
                                                           md-min-date="ctrl.calculatedMinReceivedEndDate"
                                                           ng-required="ctrl.filter.ui.key_11.value1"></md-datepicker>
                                            <div ng-messages="userFilter.receivedDateEnd.$error">
                                                <div ng-message="required">{{lang.field_required}}</div>
                                            </div>
                                        </md-input-container>
                                    </div>
                                </fieldset>

                                <fieldset layout="column" class="search-fieldset">
                                    <legend class="md-accent">{{ctrl.lookupNames['key_10'].getTranslatedName()}}
                                    </legend>
                                    <div layout="row">
                                        <!-- Due Date From -->
                                        <md-input-container flex class="cms-datepicker">
                                            <label for="key_10_1">{{lang.user_inbox_filter_from}}</label>
                                            <md-datepicker id="key_10_1" ng-model="ctrl.filter.ui.key_10.value1"
                                                           name="dueDateStart" md-open-on-focus
                                                           ng-change="ctrl.getMinDueEndDate($event)"
                                                           md-max-date="ctrl.calculatedMaxDueStartDate"
                                                           ng-required="ctrl.filter.ui.key_10.value2"></md-datepicker>
                                            <div ng-messages="userFilter.dueDateStart.$error">
                                                <div ng-message="required">{{lang.field_required}}</div>
                                            </div>
                                        </md-input-container>
                                        <!-- Due Date To -->
                                        <md-input-container flex class="cms-datepicker">
                                            <label for="key_10_2">{{lang.user_inbox_filter_to}}</label>
                                            <md-datepicker id="key_10_2" ng-model="ctrl.filter.ui.key_10.value2"
                                                           name="dueDateEnd" md-open-on-focus
                                                           ng-change="ctrl.getMaxDueStartDate($event)"
                                                           md-min-date="ctrl.calculatedMinDueEndDate"
                                                           ng-required="ctrl.filter.ui.key_10.value1"></md-datepicker>
                                            <div ng-messages="userFilter.dueDateEnd.$error">
                                                <div ng-message="required">{{lang.field_required}}</div>
                                            </div>
                                        </md-input-container>
                                    </div>
                                </fieldset>
                                <div layout="row">
                                    <!-- Serial -->
                                    <md-input-container flex>
                                        <label for="docSerial">{{ctrl.lookupNames['key_13'].getTranslatedName()}}</label>
                                        <input id="docSerial" name="docSerial" ng-model="ctrl.filter.ui.key_13.value">
                                    </md-input-container>
                                    <!-- Due Date -->
                                    <md-switch flex ng-model="ctrl.filter.ui.key_8.value"
                                               aria-label="{{ctrl.lookupNames['key_8'].getTranslatedName()}}">
                                        <label>{{ctrl.lookupNames['key_8'].getTranslatedName()}} :
                                            {{ctrl.filter.getTranslatedYesNo('key_8', $event)}}</label>
                                    </md-switch>
                                </div>
                                <div layout="row">
                                    <!-- Linked Docs -->
                                    <md-input-container flex>
                                        <label for="hasLinkedDocs">{{lang.linked_documents}}</label>
                                        <md-select id="hasLinkedDocs" ng-model="ctrl.filter.ui.key_linkedDocs.value">
                                            <md-option ng-value="null">{{lang.none}}</md-option>
                                            <md-option ng-repeat="option in ctrl.linkedDocsOptions"
                                                       ng-value="option.id">
                                                {{option.getTranslatedName()}}
                                            </md-option>
                                        </md-select>
                                    </md-input-container>
                                    <!-- Linked Entities -->
                                    <md-input-container flex>
                                        <label for="hasLinkedEntities">{{lang.linked_entities}}</label>
                                        <md-select id="hasLinkedEntities"
                                                   ng-model="ctrl.filter.ui.key_linkedEntities.value">
                                            <md-option ng-value="null">{{lang.none}}</md-option>
                                            <md-option ng-repeat="option in ctrl.linkedEntitiesOptions"
                                                       ng-value="option.id">
                                                {{option.getTranslatedName()}}
                                            </md-option>
                                        </md-select>
                                    </md-input-container>
                                </div>
                                <div layout="row">
                                    <!-- Linked Attachments -->
                                    <md-input-container flex>
                                        <label for="hasLinkedAttachments">{{lang.attachments}}</label>
                                        <md-select id="hasLinkedAttachments"
                                                   ng-model="ctrl.filter.ui.key_linkedAttachments.value">
                                            <md-option ng-value="null">{{lang.none}}</md-option>
                                            <md-option ng-repeat="option in ctrl.linkedAttachmentsOptions"
                                                       ng-value="option.id">
                                                {{option.getTranslatedName()}}
                                            </md-option>
                                        </md-select>
                                    </md-input-container>
                                    <!-- Is Open -->
                                    <md-input-container flex>
                                        <label for="isOpen">{{ctrl.lookupNames['key_20'].getTranslatedName()}}</label>
                                        <md-select id="isOpen" ng-model="ctrl.filter.ui.key_20.value">
                                            <md-option ng-value="null">{{lang.none}}</md-option>
                                            <md-option ng-repeat="option in ctrl.yesNoOptions"
                                                       ng-value="option.value">
                                                {{lang[option.key]}}
                                            </md-option>
                                        </md-select>
                                    </md-input-container>
                                </div>
                                <div layout="row" ng-if="ctrl.filter.ui.key_2.value !== 2">
                                    <!-- Correspondence Site Type -->
                                    <md-input-container flex>
                                        <label for="siteType">{{ctrl.lookupNames['key_siteType'].getTranslatedName()}}</label>
                                        <md-select name="siteType" id="siteType"
                                                   ng-model="ctrl.filter.ui.key_siteType.value"
                                                   md-on-close="ctrl.clearSearchText('siteType')"
                                                   ng-change="ctrl.getMainSites(true, $event)"
                                                   data-md-container-class="select-header-container">
                                            <md-select-header class="select-header">
                                                <input ng-model="ctrl.siteTypeSearchText"
                                                       ng-keydown="ctrl.handleSearchKeyDown($event, 'siteType')"
                                                       placeholder="{{lang.search}}"
                                                       class="select-header-input">
                                            </md-select-header>
                                            <md-option ng-value="null">{{lang.none}}</md-option>
                                            <md-option
                                                    ng-repeat="option in ctrl.correspondenceSiteTypes | translatedNameFilter: ctrl.siteTypeSearchText"
                                                    ng-value="option.lookupKey">
                                    <span
                                            md-highlight-text="ctrl.siteTypeSearchText"
                                            md-highlight-flags="i">{{option.getTranslatedName()}}</span>
                                            </md-option>
                                        </md-select>
                                    </md-input-container>
                                    <!-- Main Site -->
                                    <md-input-container flex>
                                        <label for="mainSite">{{ctrl.lookupNames['key_mainSite'].getTranslatedName()}}</label>
                                        <md-select id="mainSite" name="mainSite"
                                                   ng-model="ctrl.filter.ui.key_mainSite.value"
                                                   ng-model-options="{trackBy: '$value'}"
                                                   ng-disabled="!ctrl.filter.ui.key_siteType.value"
                                                   md-on-close="ctrl.clearSearchText('mainSite')"
                                                   ng-change="ctrl.getSubSites(true, $event)"
                                                   data-md-container-class="select-header-container">
                                            <md-select-header class="select-header" layout="column">
                                                <div layout="row" flex class="size-100">
                                                    <input ng-model="ctrl.mainSiteSearchText"
                                                           ng-keydown="ctrl.handleSearchKeyDown($event, 'mainSite')"
                                                           placeholder="{{lang.search}}"
                                                           class="select-header-input">
                                                    <md-button ng-if="ctrl.mainSiteSearchText"
                                                               ng-click="ctrl.loadMainSitesRecords($event)"
                                                               class="select-header-icon md-icon-button"
                                                               tooltip="{{lang.load_more_records}}">
                                                        <md-icon md-svg-icon="magnify-plus"></md-icon>
                                                    </md-button>
                                                </div>
                                                <div class="help-text-div" ng-if="ctrl.mainSiteSearchText">
                                                    {{lang.press_enter_to_load_more_records}}
                                                </div>
                                            </md-select-header>
                                            <md-option ng-value="null">{{lang.none}}</md-option>
                                            <md-option
                                                    ng-repeat="mainSite in ctrl.mainSites | translatedNameFilter: ctrl.mainSiteSearchText"
                                                    ng-value="mainSite.id">
                                    <span
                                            md-highlight-text="ctrl.mainSiteSearchText"
                                            md-highlight-flags="i">{{mainSite.getTranslatedName()}}</span>
                                            </md-option>
                                        </md-select>
                                    </md-input-container>
                                    <!-- Sub Site -->
                                    <md-input-container flex>
                                        <label for="subSite">{{ctrl.lookupNames['key_subSite'].getTranslatedName()}}</label>
                                        <md-select id="subSite" name="subSite"
                                                   ng-model="ctrl.filter.ui.key_subSite.value"
                                                   ng-model-options="{trackBy: '$value'}"
                                                   ng-disabled="!ctrl.filter.ui.key_siteType.value || !ctrl.filter.ui.key_mainSite.value"
                                                   md-on-close="ctrl.clearSearchText('subSite')"
                                                   data-md-container-class="select-header-container">
                                            <md-select-header class="select-header" layout="column">
                                                <div layout="row" flex class="size-100">
                                                    <input ng-model="ctrl.subSiteSearchText"
                                                           ng-keydown="ctrl.handleSearchKeyDown($event, 'subSite')"
                                                           placeholder="{{lang.search}}"
                                                           class="select-header-input">
                                                    <md-button ng-if="ctrl.subSiteSearchText"
                                                               ng-click="ctrl.loadSubSitesRecords($event)"
                                                               class="select-header-icon md-icon-button"
                                                               tooltip="{{lang.load_more_records}}">
                                                        <md-icon md-svg-icon="magnify-plus"></md-icon>
                                                    </md-button>
                                                </div>
                                                <div class="help-text-div" ng-if="ctrl.subSiteSearchText">
                                                    {{lang.press_enter_to_load_more_records}}
                                                </div>
                                            </md-select-header>
                                            <md-option ng-value="null">{{lang.none}}</md-option>
                                            <md-option
                                                    ng-repeat="subSite in ctrl.subSites | translatedNameFilter: ctrl.subSiteSearchText"
                                                    ng-value="subSite.id">
                                    <span
                                            md-highlight-text="ctrl.subSiteSearchText"
                                            md-highlight-flags="i">{{subSite.getTranslatedName()}}</span>
                                            </md-option>
                                        </md-select>
                                    </md-input-container>
                                </div>
                            </div>
                        </md-content>
                    </md-tab>
                </md-tabs>
            </form>
        </div>
    </md-dialog-content>
    <md-dialog-actions class="cms-dialog-actions">
        <md-button class="md-raised md-primary" ng-if="!ctrl.editMode" ng-disabled="ctrl.checkDisabled(userFilter)"
                   ng-click="ctrl.saveUserFilterFromCtrl()">{{lang.add}}
        </md-button>
        <md-button class="md-raised md-primary" ng-if="ctrl.editMode" ng-disabled="ctrl.checkDisabled(userFilter)"
                   ng-click="ctrl.saveUserFilterFromCtrl()">
            {{lang.save}}
        </md-button>
        <md-button class="md-raised" ng-click="ctrl.resetFilterForm(userFilter, $event)">
            {{lang.reset}}
        </md-button>
        <md-button class="md-raised red-text" ng-click="ctrl.closeFilterForm($event)">
            {{lang.close}}
        </md-button>
    </md-dialog-actions>
</md-dialog>
