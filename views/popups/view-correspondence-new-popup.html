<md-dialog id="correspondence-dialog" class="fullscreen" ng-class="{'fullscreen':ctrl.fullScreen}"
           ng-attr-aria-label="{{lang.view_document}}" layout="column">
    <div layout="row" layout-align="start center">
        <md-button ng-if="ctrl.correspondence" ng-click="ctrl.toggleCorrespondenceDetails()"
                   class="md-icon-button">
            <md-icon md-svg-icon="menu"></md-icon>
        </md-button>
        <correspondence-view-action-directive ng-if="ctrl.actions.length"
                                              actions="ctrl.actions"
                                              work-item="ctrl.workItem"
                                              correspondence="ctrl.correspondence"
                                              g2g-item-copy="ctrl.g2gItemCopy"
                                              edit-mode="ctrl.editMode"
                                              save-correspondence-changes="ctrl.saveCorrespondenceChanges"></correspondence-view-action-directive>
        <div flex layout-align="center center" layout="row">
            <span flex md-truncate class="font-bold text-center">{{::ctrl.correspondence.getTranslatedName()}}</span>
            <md-progress-circular ng-if="ctrl.loadingIndicatorService.loading" md-mode="indeterminate"
                                  md-diameter="30"></md-progress-circular>
        </div>
        <md-button ng-disabled="ctrl.editMode" class="md-raised"
                   ng-if="ctrl.info.needToApprove() && ctrl.employeeCanEditContent() && !ctrl.correspondence.viewVersion"
                   ng-click="ctrl.toggleCorrespondenceEditMode()">
            {{lang.edit_content}}
        </md-button>
        <md-button ng-click="ctrl.toggleFullScreen()" class="md-icon-button">
            <md-icon md-svg-icon="{{ctrl.fullScreen ? 'fullscreen-exit': 'fullscreen'}}"></md-icon>
        </md-button>
        <md-button ng-if="!ctrl.correspondence" ng-click="ctrl.returnBackCorrespondenceInformation()"
                   class="md-icon-button">
            <md-icon md-svg-icon="close" class="red-text"></md-icon>
        </md-button>
        <md-button ng-if="ctrl.correspondence" ng-click="ctrl.closeCorrespondenceDialog()"
                   class="md-icon-button">
            <md-icon md-svg-icon="close" class="red-text"></md-icon>
        </md-button>
    </div>
    <md-dialog-content layout="column" flex scroll-directive>
        <div layout="row" layout-fill flex>
            <md-sidenav ng-if="ctrl.detailsReady && ctrl.correspondence" id="correspondence-details"
                        md-whiteframe="3"
                        ng-class="{'md-sidenav-right':lang.current === 'ar'}"
                        md-component-id="{{ctrl.sideNavId}}">
                <div class="p20" scroll-directive>
                    <accordion-directive label-collapse="true" validation="ctrl.validation">
                        <accordion-item fail-when="ctrl.document_properties.$invalid"
                                        pass-when="ctrl.document_properties.$valid">
                            <accordion-title>
                                <md-icon md-svg-icon="file-document-box"></md-icon>
                                <span> &nbsp;{{lang.document_properties}}</span>
                            </accordion-title>
                            <accordion-content>
                                <manage-properties-directive
                                        source-model="ctrl.model"
                                        source-form="ctrl.document_properties"
                                        document="ctrl.correspondence"
                                        disable-properties="ctrl.disableProperties"
                                        action="ctrl.action">
                                </manage-properties-directive>
                            </accordion-content>
                        </accordion-item>
                        <accordion-item ng-if="ctrl.hasCorrespondenceSite()"
                                        fail-when="!ctrl.correspondence.sitesInfoTo.length"
                                        pass-when="!!ctrl.correspondence.sitesInfoTo.length">
                            <accordion-title>
                                <md-icon md-svg-icon="arrange-send-backward"></md-icon>
                                <span>{{lang.manage_correspondence_sites}}</span>
                            </accordion-title>
                            <accordion-content>
                                <div>
                                    <manage-correspondence-sites-directive
                                            ng-if="ctrl.correspondence.docClassName !== 'Incoming'"
                                            vs-id="ctrl.correspondence.vsId"
                                            document-class="ctrl.correspondence.docClassName"
                                            sites-info-c-c="ctrl.correspondence.sitesInfoCC"
                                            sites-info-to="ctrl.correspondence.sitesInfoTo"
                                            disable-correspondence="ctrl.disableCorrespondence">
                                    </manage-correspondence-sites-directive>
                                    <manage-correspondence-site-incoming-directive
                                            ng-if="ctrl.correspondence.docClassName === 'Incoming'"
                                            vs-id="ctrl.correspondence.vsId"
                                            site="ctrl.correspondence.site"
                                            document-class="ctrl.correspondence.docClassName"
                                            disable-correspondence="ctrl.disableCorrespondence"></manage-correspondence-site-incoming-directive>
                                </div>
                            </accordion-content>
                        </accordion-item>
                        <accordion-item pass-when="!!ctrl.correspondence.attachments.length">
                            <accordion-title>
                                <md-icon md-svg-icon="attachment"></md-icon>
                                <span>{{lang.outgoing_manage_attachments}}</span>
                            </accordion-title>
                            <accordion-content>
                                <div layout="row">
                                    <manage-attachment-directive
                                            document="ctrl.correspondence"
                                            attachments="ctrl.correspondence.attachments"
                                            linked-exported-attachments="self.correspondence.linkedExportedDocsList"
                                            vs-id="ctrl.correspondence.vsId"
                                            document-class="ctrl.correspondence.docClassName"
                                            disable-everything="ctrl.disableEverything" flex>
                                    </manage-attachment-directive>
                                </div>
                            </accordion-content>
                        </accordion-item>
                        <accordion-item pass-when="!!ctrl.correspondence.linkedDocs.length"
                                        ng-if="ctrl.employeeService.hasPermissionTo('MANAGE_LINKED_DOCUMENTS')">
                            <accordion-title>
                                <md-icon md-svg-icon="note-multiple-outline"></md-icon>
                                <span>{{lang.outgoing_manage_linked_document}}</span>
                            </accordion-title>
                            <accordion-content>
                                <div>
                                    <manage-linked-document-directive
                                            linked-docs="ctrl.correspondence.linkedDocs"
                                            vs-id="ctrl.correspondence.vsId"
                                            document-class="ctrl.correspondence.docClassName"
                                            disable-everything="ctrl.disableEverything">
                                    </manage-linked-document-directive>
                                </div>
                            </accordion-content>
                        </accordion-item>
                        <accordion-item pass-when="!!ctrl.correspondence.linkedEntities.length">
                            <accordion-title>
                                <md-icon md-svg-icon="vector-triangle"></md-icon>
                                <span>{{lang.outgoing_linked_entities}}</span>
                            </accordion-title>
                            <accordion-content>
                                <div>
                                    <manage-entities-directive
                                            vs-id="ctrl.correspondence.vsId"
                                            linked-entities="ctrl.correspondence.linkedEntities"
                                            document-class="ctrl.correspondence.docClassName"
                                            disable-everything="ctrl.disableEverything">
                                    </manage-entities-directive>
                                </div>
                            </accordion-content>
                        </accordion-item>
                        <accordion-item pass-when="!!ctrl.correspondence.documentComments.length"
                                        ng-if="ctrl.employeeService.hasPermissionTo('MANAGE_DOCUMENT’S_COMMENTS')">
                            <accordion-title>
                                <md-icon md-svg-icon="comment"></md-icon>
                                <span>{{lang.outgoing_manage_comments}}</span>
                            </accordion-title>
                            <accordion-content>
                                <div layout="row">
                                    <manage-comments-directive
                                            vs-id="ctrl.correspondence.vsId"
                                            document-comments="ctrl.correspondence.documentComments"
                                            show-comment-form="ctrl.showDocumentComment"
                                            disable-everything="ctrl.disableEverything"
                                            flex>
                                    </manage-comments-directive>
                                </div>
                            </accordion-content>
                        </accordion-item>
                        <accordion-item pass-when="!!ctrl.correspondence.tags.length"
                                        ng-if="ctrl.employeeService.hasPermissionTo('MANAGE_DOCUMENT’S_TAGS')">
                            <accordion-title>
                                <md-icon md-svg-icon="tag-multiple"></md-icon>
                                <span>{{lang.outgoing_manage_tags}}</span>
                            </accordion-title>
                            <accordion-content>
                                <div>
                                    <manage-tags-directive from-dialog="false"
                                                           tags="ctrl.correspondence.tags"
                                                           disable-everything="ctrl.disableEverything">
                                    </manage-tags-directive>
                                </div>
                            </accordion-content>
                        </accordion-item>
                    </accordion-directive>
                </div>
            </md-sidenav>
            <md-sidenav md-is-locked-open="true" ng-if="true">
                <div class="p020" layout="column" scroll-directive>
                    <ul layout="column" flex id="document-properties">
                        <work-item-properties-directive section-title="workitem_information" ng-if="ctrl.workItem"
                                                        item="ctrl.workItem"></work-item-properties-directive>
                        <correspondence-item-properties-directive
                                section-title="general_information"
                                item="ctrl.correspondence"></correspondence-item-properties-directive>
                        <!-- Quick Actions -->
                        <li>
                            <div class="viewer-actions">
                                <md-button
                                        ng-repeat="quickAction in ctrl.stickyActions track by $index"
                                        ng-if="ctrl.isShowViewerAction(quickAction)" class="md-fab md-mini"
                                        aria-label="{{ctrl.getViewerActionText(quickAction, true)}}"
                                        ng-click="ctrl.callbackViewerAction(quickAction, $event)"
                                        tooltip="{{ctrl.getViewerActionText(quickAction, true)}}"
                                        tooltip-direction="{{lang.current === 'ar' ? 'left': 'right'}}">
                                    <md-icon md-svg-icon="{{quickAction.icon}}"
                                             class="{{quickAction.class}}"
                                    ></md-icon>
                                </md-button>
                            </div>
                        </li>

                        <li class="document-properties linked document-attachments">
                            <ul class="work-item-properties">
                                <li class="section-title">
                                    <div layout="row" layout-align="start center">
                                        <span flex>{{lang.get('attachments')}}</span>
                                        <md-button class="md-icon-button collapse-button"
                                                   ng-if="ctrl.employeeService.hasPermissionTo('MANAGE_ATTACHMENTS')"
                                                   aria-label="{{lang.grid_action_attachments}}"
                                                   ng-click="ctrl.manageAttachments($event)"
                                                   tooltip="{{lang.grid_action_attachments}}"
                                                   tooltip-direction="{{lang.current === 'ar' ? 'left': 'right'}}">
                                            <md-icon md-svg-icon="settings-box"></md-icon>
                                        </md-button>
                                    </div>
                                </li>
                                <li ng-class="{'selected':ctrl.checkSelected($index , 'attachments')}"
                                    layout-align="start center" layout="row"
                                    ng-repeat="attachment in ctrl.correspondence.attachments track by $index">
                                    <a flex href="#" ng-click="ctrl.showAttachment(attachment , $index , $event)">{{attachment.getTranslatedName()}}</a>
                                </li>
                            </ul>
                        </li>
                        <li class="document-properties linked linked-documents">
                            <ul class="work-item-properties">
                                <li class="section-title">
                                    <div layout="row" layout-align="start center">
                                        <span flex>{{lang.get('linked_documents')}}</span>
                                        <md-button class="md-icon-button collapse-button"
                                                   ng-if="ctrl.employeeService.hasPermissionTo('MANAGE_LINKED_DOCUMENTS')"
                                                   aria-label="{{lang.grid_action_linked_documents}}"
                                                   ng-click="ctrl.manageLinkedDocuments($event)"
                                                   tooltip="{{lang.grid_action_linked_documents}}"
                                                   tooltip-direction="{{lang.current === 'ar' ? 'left': 'right'}}">
                                            <md-icon md-svg-icon="settings-box"></md-icon>
                                        </md-button>
                                    </div>
                                </li>
                                <li ng-class="{'selected':ctrl.checkSelected($index , 'linkedDocs')}"
                                    layout-align="start center" layout="row"
                                    ng-repeat="doc in ctrl.correspondence.linkedDocs track by $index">
                                    <a flex href="#" ng-click="ctrl.showLinkedDocument(doc , $index ,  $event)">{{doc.getTranslatedName()}}</a>
                                    <md-button class="md-icon-button view-icon-button"
                                               tooltip="{{lang.open_in_new_popup}}" tooltip-direction="right"
                                               ng-click="ctrl.showLinkedDocument(doc, $index ,  $event , true)">
                                        <md-icon md-svg-icon="open-in-new"></md-icon>
                                    </md-button>
                                    &nbsp;&nbsp;
                                    <md-button class="md-icon-button view-icon-button"
                                               ng-if="ctrl.employeeService.hasPermissionTo('VIEW_DOCUMENT\'S_TRACKING_SHEET')"
                                               tooltip="{{lang.grid_action_view_tracking_sheet}}"
                                               tooltip-direction="right"
                                               ng-click="ctrl.viewTrackingSheet(doc, $index ,  $event)">
                                        <md-icon md-svg-icon="eye"></md-icon>
                                    </md-button>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </md-sidenav>
            <div layout="column" class="relative" flex>
                <div ng-if="ctrl.content.desktop && ctrl.content.desktop.overlay"
                     ng-click="ctrl.reloadMainDocument($event)" layout="column" layout-align="center center"
                     id="overlay-to-reload-document">
                    <p>{{lang.reload_document_after_edit_in_desktop}}</p>
                    <md-button id="reload-main-document" ng-click="ctrl.reloadMainDocument($event)"
                               class="md-icon-button md-primary md-raised">
                        <md-icon md-svg-icon="reload"></md-icon>
                    </md-button>
                </div>
                <iframe ng-if="ctrl.mainDocument && !ctrl.editMode && ctrl.viewURL" id="iframe-main-document"
                        class="iframe-main-document"
                        ng-src="{{ctrl.viewURL}}" flex
                        frameborder="0"></iframe>

                <iframe ng-if="ctrl.mainDocument && ctrl.editMode" id="iframe-main-document"
                        class="iframe-main-document"
                        ng-src="{{ctrl.content.editURL}}" flex
                        frameborder="0"></iframe>

                <div ng-if="!ctrl.mainDocument" class="absolute-back-button">
                    <md-button tooltip="{{lang.back_to_main_document}}" class="md-icon-button md-raised"
                               ng-click="ctrl.backToCorrespondence()">
                        <md-icon md-svg-icon="backup-restore"></md-icon>
                    </md-button>
                </div>

                <div ng-if="!ctrl.mainDocument && ctrl.hasMoreThanOne()"
                     class="absolute-back-button navigate-next">
                    <md-button ng-disabled="!ctrl.hasNext()" tooltip="{{lang.next}}"
                               class="md-icon-button md-raised"
                               ng-click="ctrl.nextItemList()">
                        <md-icon md-svg-icon="chevron-right"></md-icon>
                    </md-button>
                </div>

                <div ng-if="!ctrl.mainDocument && ctrl.hasMoreThanOne()"
                     class="absolute-back-button navigate-prev">
                    <md-button ng-disabled="!ctrl.hasPrevious()" tooltip="{{lang.previous}}"
                               class="md-icon-button md-raised"
                               ng-click="ctrl.prevItemList()">
                        <md-icon md-svg-icon="chevron-left"></md-icon>
                    </md-button>
                </div>

                <iframe ng-if="!ctrl.mainDocument" class="iframe-main-document" ng-src="{{ctrl.secondURL}}" flex
                        frameborder="0"></iframe>

            </div>
        </div>
    </md-dialog-content>
    <md-dialog-actions class="cms-dialog-actions">
        <div ng-if="ctrl.correspondence && !ctrl.correspondence.viewVersion && !ctrl.g2gItemCopy &&  !ctrl.disableEverything && ( ctrl.pageName !=='departmentIncoming' || (ctrl.pageName === 'departmentIncoming' && ctrl.workItem &&  ctrl.workItem.generalStepElm.isReassigned))">
            <md-button class="md-raised" ng-click="ctrl.saveCorrespondenceChanges($event, false)"
                       ng-disabled="ctrl.checkDisabled() || ctrl.document_properties.$invalid">{{lang.save}}
            </md-button>
        </div>
        <div ng-if="!ctrl.correspondence && !ctrl.g2gItemCopy">
            <md-button class="md-raised" ng-click="ctrl.returnBackCorrespondenceInformation()">{{lang.save}}
            </md-button>
        </div>
        <span flex></span>
        <div ng-if="ctrl.correspondence">
            <md-button class="md-raised red-text" ng-click="ctrl.closeCorrespondenceDialog()">{{lang.close}}
            </md-button>
        </div>
        <div ng-if="!ctrl.correspondence">
            <md-button class="md-raised red-text" ng-click="ctrl.returnBackCorrespondenceInformation()">
                {{lang.close}}
            </md-button>
        </div>
    </md-dialog-actions>
</md-dialog>
