<md-dialog class="dialog-extend mw60 cms-tabs-dialog" layout="column"
           ng-class="{'cms-dialog-full-screen':ctrl.fullScreen}"
           ng-attr-aria-label="{{lang.user_preferences}}">
    <popup-toolbar-directive
            header-text="{{lang.user_preferences}} : {{ctrl.model.getNames()}}"></popup-toolbar-directive>
    <md-dialog-content scroll-directive flex>
        <div>
            <form name="userPreferencesForm" autocomplete="off">
                <md-tabs md-dynamic-height md-selected="ctrl.selectedTabIndex">
                    <!-- General Tab -->
                    <md-tab label="{{lang.general}}" ng-if="ctrl.showTab('general')"
                            md-on-select="ctrl.setCurrentTab('general')">
                        <md-content class="md-padding">
                            <div layout="column">
                                <div layout="row">
                                    <!-- Arabic Full Name -->
                                    <md-input-container flex>
                                        <label for="arFullName">{{lang.arabic_full_name}}</label>
                                        <input name="arFullName" id="arFullName" required minlength="2"
                                               ng-model="ctrl.applicationUser.arFullName"
                                               ng-disabled="true" ng-readonly="true"
                                               maxlength="80">
                                        <div ng-messages="userPreferencesForm.arFullName.$error">
                                            <div ng-message="required">{{lang.field_required}}</div>
                                            <div ng-message="minlength">{{lang.short}}</div>
                                            <div ng-message="ANS">{{lang.arabic_number_space}}</div>
                                            <div ng-message="maxlength">{{lang.max_length.change({length:80})}}</div>
                                        </div>
                                    </md-input-container>
                                    <!-- English Full Name -->
                                    <md-input-container flex>
                                        <label for="enFullName">{{lang.english_full_name}}</label>
                                        <input name="enFullName" id="enFullName" required minlength="2"
                                               ng-model="ctrl.applicationUser.enFullName"
                                               ng-disabled="true" ng-readonly="true"
                                               maxlength="80">
                                        <div ng-messages="userPreferencesForm.enFullName.$error">
                                            <div ng-message="required">{{lang.field_required}}</div>
                                            <div ng-message="minlength">{{lang.short}}</div>
                                            <div ng-message="ENS">{{lang.english_number_space}}</div>
                                            <div ng-message="maxlength">{{lang.max_length.change({length:80})}}</div>
                                        </div>
                                    </md-input-container>
                                </div>
                                <div layout="row">
                                    <!-- Gender -->
                                    <md-input-container flex>
                                        <label for="gender">{{lang.gender}}</label>
                                        <md-select id="gender" name="gender" required
                                                   ng-disabled="true" ng-readonly="true"
                                                   ng-model="ctrl.applicationUser.gender">
                                            <md-option ng-value="gender.lookupKey"
                                                       ng-repeat="gender in ctrl.genders track by $index">
                                                {{gender.getTranslatedName()}}
                                            </md-option>
                                        </md-select>
                                        <div ng-messages="userPreferencesForm.gender.$error">
                                            <div ng-message="required">{{lang.field_required}}</div>
                                        </div>
                                    </md-input-container>
                                    <!-- Domain Name -->
                                    <md-input-container flex>
                                        <label for="domainName">{{lang.domain_name}}</label>
                                        <input name="domainName" id="domainName" required minlength="2"
                                               ng-disabled="true" ng-readonly="true"
                                               ng-model="ctrl.applicationUser.domainName" maxlength="50"
                                               no-space-directive custom-validate-directive="FILE_NET_USER">
                                        <div ng-messages="userPreferencesForm.domainName.$error">
                                            <div ng-message="required">{{lang.field_required}}</div>
                                            <div ng-message="minlength">{{lang.short}}</div>
                                            <div ng-message="maxlength">{{lang.max_length.change({length:50})}}</div>
                                            <div ng-message="FILE_NET_USER">{{lang.english_number}}</div>
                                        </div>
                                    </md-input-container>
                                    <!-- Login Name -->
                                    <!--   <md-input-container flex>
                                           <label for="loginName">{{lang.login_name}}</label>
                                           <input name="loginName" id="loginName" required minlength="2"
                                                  ng-disabled="true" ng-readonly="true"
                                                  ng-model="ctrl.applicationUser.loginName"
                                                  no-space-directive custom-validate-directive="FILE_NET_USER">
                                           <div ng-messages="userPreferencesForm.loginName.$error">
                                               <div ng-message="required">{{lang.field_required}}</div>
                                               <div ng-message="minlength">{{lang.short}}</div>
                                               <div ng-message="FILE_NET_USER">{{lang.english_number}}</div>
                                           </div>
                                       </md-input-container>-->
                                </div>
                                <div layout="row">
                                    <!-- Employee Number -->
                                    <md-input-container flex>
                                        <label for="employeeNo">{{lang.employee_number}}</label>
                                        <input name="employeeNo" id="employeeNo" required
                                               ng-disabled="true" ng-readonly="true"
                                               ng-model="ctrl.applicationUser.employeeNo" maxlength="10"
                                               custom-validate-directive="number">
                                        <div ng-messages="userPreferencesForm.employeeNo.$error">
                                            <div ng-message="required">{{lang.field_required}}</div>
                                            <div ng-message="number">{{lang.numberonly}}</div>
                                            <div ng-message="maxlength">{{lang.max_length.change({length:10})}}</div>
                                        </div>
                                    </md-input-container>
                                    <!-- Qatari Id -->
                                    <md-input-container flex>
                                        <label for="qid">{{lang.qid}}</label>
                                        <input name="qid" id="qid" required maxlength="11"
                                               ng-disabled="true" ng-readonly="true"
                                               ng-model="ctrl.applicationUser.qid"
                                               custom-validate-directive="number">
                                        <div ng-messages="userPreferencesForm.qid.$error">
                                            <div ng-message="required">{{lang.field_required}}</div>
                                            <div ng-message="number">{{lang.numberonly}}</div>
                                            <div ng-message="maxlength">{{lang.max_length.change({length:11})}}</div>
                                        </div>
                                    </md-input-container>
                                </div>
                                <div layout="row">
                                    <!-- Rank -->
                                    <div flex layout="row">
                                        <md-input-container flex>
                                            <label for="rank">{{lang.rank}}</label>
                                            <md-select id="rank" name="rank"
                                                       ng-disabled="true" ng-readonly="true"
                                                       ng-model="ctrl.applicationUser.rank"
                                                       ng-model-options="{trackBy: '$value'}"
                                                       md-on-close="ctrl.clearSearchText('rank')"
                                                       data-md-container-class="select-header-container sticky-search-bar">
                                                <!--required ng-disabled="true" ng-readonly="true"-->
                                                <md-select-header class="select-header">
                                                    <input ng-model="ctrl.rankSearchText"
                                                           ng-keydown="ctrl.preventSearchKeyDown($event)"
                                                           placeholder="{{lang.search}}"
                                                           class="select-header-input">
                                                </md-select-header>
                                                <md-option ng-value="rank.lookupKey"
                                                           ng-repeat="rank in ctrl.ranks | translatedNameFilter: ctrl.rankSearchText">
                                                    <span
                                                            md-highlight-text="ctrl.rankSearchText"
                                                            md-highlight-flags="i">{{rank.getTranslatedName()}}</span>
                                                </md-option>
                                            </md-select>
                                            <div ng-messages="userPreferencesForm.rank.$error">
                                                <div ng-message="required">{{lang.field_required}}</div>
                                            </div>
                                        </md-input-container>
                                    </div>
                                    <!-- Job Title -->
                                    <div flex layout="row">
                                        <md-input-container flex>
                                            <label for="jobTitle">{{lang.job_title}}</label>
                                            <md-select id="jobTitle" name="jobTitle" required
                                                       ng-disabled="true" ng-readonly="true"
                                                       ng-model="ctrl.applicationUser.jobTitle"
                                                       ng-model-options="{trackBy: '$value'}"
                                                       md-on-close="ctrl.clearSearchText('jobTitle')"
                                                       data-md-container-class="select-header-container sticky-search-bar">
                                                <md-select-header class="select-header">
                                                    <input ng-model="ctrl.jobTitleSearchText"
                                                           ng-keydown="ctrl.preventSearchKeyDown($event)"
                                                           placeholder="{{lang.search}}"
                                                           class="select-header-input">
                                                </md-select-header>
                                                <md-option ng-value="jobTitle.lookupKey"
                                                           ng-repeat="jobTitle in ctrl.jobTitles | translatedNameFilter:ctrl.jobTitleSearchText">
                                                    <span
                                                            md-highlight-text="ctrl.jobTitleSearchText"
                                                            md-highlight-flags="i">{{jobTitle.getTranslatedName()}}</span>
                                                </md-option>
                                            </md-select>
                                            <div ng-messages="userPreferencesForm.jobTitle.$error">
                                                <div ng-message="required">{{lang.field_required}}</div>
                                            </div>
                                        </md-input-container>
                                        <!--<md-input-container>
                                            <md-button
                                                    tooltip="{{lang.add_new_job_title}}"
                                                    ng-click="ctrl.openAddJobTitleDialog($event)"
                                                    class="md-icon-button">
                                                <md-icon md-svg-icon="plus"></md-icon>
                                            </md-button>
                                        </md-input-container>-->
                                    </div>
                                </div>
                                <div layout="row">
                                    <!-- Email -->
                                    <md-input-container flex>
                                        <label for="email">{{lang.email}}</label>
                                        <input name="email" id="email" required maxlength="50"
                                               ng-model="ctrl.applicationUser.email"
                                               custom-validate-directive="email">
                                        <div ng-messages="userPreferencesForm.email.$error">
                                            <div ng-message="required">{{lang.field_required}}</div>
                                            <div ng-message="email">
                                                {{lang.invalid_email}}
                                            </div>
                                            <div ng-message="maxlength">{{lang.max_length.change({length:50})}}</div>
                                        </div>
                                    </md-input-container>
                                    <!-- Mobile Number -->
                                    <md-input-container flex>
                                        <label for="mobile">{{lang.mobile_number}}</label>
                                        <input name="mobile" id="mobile" required
                                               ng-model="ctrl.applicationUser.mobile" maxlength="15"
                                               custom-validate-directive="phone_mobile">
                                        <div ng-messages="userPreferencesForm.mobile.$error">
                                            <div ng-message="required">{{lang.field_required}}</div>
                                            <div ng-message="phone_mobile">
                                                {{lang.invalid_phone_mobile.change({phonemob:lang.mobile})}}
                                            </div>
                                            <div ng-message="maxlength">{{lang.max_length.change({length:15})}}</div>
                                        </div>
                                    </md-input-container>
                                    <!-- Registered Mobile Number for OTP -->
                                    <!--<md-input-container flex>&lt;!&ndash; class=not-found&ndash;&gt;
                                        <label for="mobileOTP">{{lang.mobile_number_otp}}</label>
                                        <input name="mobileOTP" id="mobileOTP"
                                               ng-model="ctrl.notFound.mobile" maxlength="15"
                                               custom-validate-directive="phone_mobile">
                                        <div ng-messages="userPreferencesForm.mobileOTP.$error">
                                            <div ng-message="phone_mobile">
                                                {{lang.invalid_phone_mobile.change({phonemob:lang.mobile})}}
                                            </div>
                                            <div ng-message="maxlength">{{lang.max_length.change({length:15})}}</div>
                                        </div>
                                    </md-input-container>-->
                                </div>
                                <div layout="row">
                                    <!-- Theme -->
                                    <div flex layout="row">
                                        <md-input-container flex>
                                            <label for="defaultThemeID">{{lang.default_theme}}</label>
                                            <!--ng-disabled="true" ng-readonly="true"-->
                                            <md-select id="defaultThemeID" name="defaultThemeID" required
                                                       ng-model="ctrl.applicationUser.defaultThemeID">
                                                <md-option ng-value="theme.id"
                                                           ng-repeat="theme in ctrl.themes track by $index">
                                                    {{theme.getTranslatedName()}}
                                                </md-option>
                                            </md-select>
                                            <div ng-messages="userPreferencesForm.defaultThemeID.$error">
                                                <div ng-message="required">{{lang.field_required}}</div>
                                            </div>
                                        </md-input-container>
                                    </div>
                                    <!-- Language -->
                                    <md-input-container flex>
                                        <label for="defaultDisplayLang">{{lang.default_language}}</label>
                                        <md-select id="defaultDisplayLang" name="defaultDisplayLang" required
                                                   ng-model="ctrl.applicationUser.defaultDisplayLang">
                                            <md-option ng-value="language.lookupKey"
                                                       ng-repeat="language in ctrl.languages track by $index">
                                                {{language.getTranslatedName()}}
                                            </md-option>
                                        </md-select>
                                        <div ng-messages="userPreferencesForm.defaultDisplayLang.$error">
                                            <div ng-message="required">{{lang.field_required}}</div>
                                        </div>
                                    </md-input-container>
                                </div>
                                <div layout="row">
                                    <!-- Search Amount Limit -->
                                    <md-input-container flex>
                                        <label for="searchAmountLimit">{{lang.default_max_row_search}}</label>
                                        <input name="searchAmountLimit" id="searchAmountLimit" required
                                               ng-model="ctrl.applicationUser.searchAmountLimit" maxlength="5"
                                               min-max-number-directive min="0"
                                               max="ctrl.rootEntity.returnRootEntity().settings.searchAmountLimit"
                                               custom-validate-directive="number">
                                        <div ng-messages="userPreferencesForm.searchAmountLimit.$error">
                                            <div ng-message="required">{{lang.field_required}}</div>
                                            <div ng-message="maxlength">{{lang.max_length.change({length:5})}}</div>
                                            <div ng-message="number">{{lang.numberonly}}</div>
                                            <div ng-message="min">{{lang.min_number.change({number:0})}}</div>
                                            <div ng-message="max">
                                                {{lang.max_number.change({number:ctrl.maxRowCount})}}
                                            </div>
                                        </div>
                                    </md-input-container>
                                    <!-- View Inbox -->
                                    <md-input-container flex>
                                        <label for="viewInboxAsGrid">{{lang.view_inbox_as}}</label>
                                        <md-select id="viewInboxAsGrid" name="viewInboxAsGrid" required
                                                   ng-model="ctrl.applicationUser.viewInboxAsGrid">
                                            <md-option ng-value="viewType.value"
                                                       ng-repeat="viewType in ctrl.viewInboxAsOptions track by $index">
                                                {{lang[viewType.key]}}
                                            </md-option>
                                        </md-select>
                                        <div ng-messages="applicationUserForm.viewInboxAsGrid.$error">
                                            <div ng-message="required">{{lang.field_required}}</div>
                                        </div>
                                    </md-input-container>
                                </div>
                                <!--<div layout="row" flex>
                                    &lt;!&ndash; Subscription SMS &ndash;&gt;
                                    <md-switch id="subscriptionsmsNotify" name="subscriptionsmsNotify"
                                               flex ng-model="ctrl.applicationUser.subscriptionsmsNotify"
                                               ng-change="ctrl.changeSMSNotifications(userPreferencesForm, $event)"
                                               aria-label="{{lang.subscription_sms}}">
                                        <label>{{lang.subscription_sms}} :
                                            {{ctrl.applicationUser.getTranslatedYesNo('subscriptionsmsNotify')}}</label>
                                    </md-switch>
                                    &lt;!&ndash; Subscription Email &ndash;&gt;
                                    <md-switch flex ng-model="ctrl.applicationUser.subscriptionEmailNotify"
                                               ng-change="ctrl.changeEmailNotifications($event)"
                                               aria-label="{{lang.subscription_email}}">
                                        <label>{{lang.subscription_email}} :
                                            {{ctrl.applicationUser.getTranslatedYesNo('subscriptionEmailNotify')}}</label>
                                    </md-switch>
                                </div>-->
                                <div layout="row">
                                    <!-- Default Viewer Language -->
                                    <md-input-container flex>
                                        <label for="defaultViewerLang">{{lang.default_viewer_language}}</label>
                                        <md-select id="defaultViewerLang" name="defaultViewerLang" required
                                                   ng-model="ctrl.applicationUser.defaultViewerLang">
                                            <md-option ng-value="language.lookupKey"
                                                       ng-repeat="language in ctrl.languages track by $index">
                                                {{language.getTranslatedName()}}
                                            </md-option>
                                        </md-select>
                                        <div ng-messages="userPreferencesForm.defaultViewerLang.$error">
                                            <div ng-message="required">{{lang.field_required}}</div>
                                        </div>
                                    </md-input-container>
                                    <!-- Default Edit Mode -->
                                    <md-input-container flex>
                                        <label for="defaultEditMode">{{lang.default_edit_mode}}</label>
                                        <md-select id="defaultEditMode" name="defaultEditMode"
                                                   ng-model="ctrl.applicationUser.defaultEditMode">
                                            <md-option ng-value="0">{{lang.both_editor}}</md-option>
                                            <md-option ng-value="1">{{lang.oos}}</md-option>
                                            <md-option ng-value="2">{{lang.desktop}}</md-option>
                                        </md-select>
                                    </md-input-container>
                                </div>
                                <div layout="row" flex>
                                    <!-- Inbox Refresh Interval -->
                                    <md-input-container flex>
                                        <label for="inboxRefreshInterval">{{lang.inbox_refresh_interval}}</label>
                                        <input name="inboxRefreshInterval" id="inboxRefreshInterval" required
                                               ng-model="ctrl.applicationUser.inboxRefreshInterval"
                                               min-max-number-directive min="5"
                                               max="60"
                                               custom-validate-directive="number">
                                        <div ng-messages="userPreferencesForm.inboxRefreshInterval.$error">
                                            <div ng-message="required">{{lang.field_required}}</div>
                                            <div ng-message="min">{{lang.min_number.change({number:4})}}</div>
                                            <div ng-message="max">{{lang.max_number.change({number:61})}}</div>
                                            <div ng-message="number">{{lang.numberonly}}</div>
                                        </div>
                                    </md-input-container>
                                    <!-- Organization Unit -->
                                    <md-input-container flex>
                                        <label for="defaultOUID">{{lang.organization_unit}}</label>
                                        <md-select id="defaultOUID" name="defaultOUID" required
                                                   ng-model="ctrl.applicationUser.defaultOUID">
                                            <!--<md-option ng-value="organization.ou.id"
                                                       ng-disabled="!organization.status"
                                                       tooltip="{{(!organization.status) ? lang.inactive_organization : ''}}"
                                                       ng-repeat="organization in ctrl.organizationsForAppUser track by $index">
                                                {{organization.ou.getTranslatedName()}}
                                            </md-option>-->
                                            <md-option ng-value="organization.id"
                                                       ng-disabled="!organization.status"
                                                       tooltip="{{(!organization.status) ? lang.inactive_organization : ''}}"
                                                       ng-repeat="organization in ctrl.organizationsForAppUser track by $index">
                                                {{organization.getTranslatedName()}}
                                            </md-option>
                                        </md-select>
                                        <div ng-messages="userPreferencesForm.defaultOUID.$error">
                                            <div ng-message="required">{{lang.field_required}}</div>
                                        </div>
                                    </md-input-container>
                                </div>
                                <div layout="row">
                                    <div class="cms-input-container" flex>
                                        <md-switch flex ng-model="ctrl.applicationUser.slowConnectionMode"
                                                   ng-disabled="!ctrl.globalSetting.slowConnectionMode"
                                                   aria-label="{{lang.slow_connection_mode}}">
                                            <label>{{lang.slow_connection_mode}} :
                                                {{ctrl.applicationUser.getTranslatedYesNo('slowConnectionMode')}}</label>
                                        </md-switch>
                                    </div>
                                    <div class="cms-input-container" flex>
                                        <md-switch flex ng-model="ctrl.applicationUser.pinCodePrompt"
                                                   ng-disabled="!ctrl.globalSetting.isDigitalCertificateEnabled()"
                                                   aria-label="{{lang.prompt_for_pincode_in_approve}}">
                                            <label>{{lang.prompt_for_pincode_in_approve}} :
                                                {{ctrl.applicationUser.getTranslatedYesNo('pinCodePrompt')}}</label>
                                        </md-switch>
                                    </div>
                                </div>
                            </div>
                        </md-content>
                    </md-tab>
                    <!-- Notification Settings Tab -->
                    <md-tab label="{{lang.notification_settings}}" ng-if="ctrl.showTab('notificationSettings')"
                            md-on-select="ctrl.setCurrentTab('notificationSettings')">
                        <md-content class="md-padding">
                            <div layout="column">
                                <!-- SMS Notifications -->
                                <fieldset>
                                    <legend class="md-accent">
                                        {{lang.sms_settings}}
                                    </legend>
                                    <div class="full-width-fieldset">
                                        <span class="red-text" ng-if="!ctrl.globalSetting.enableSMSNotification">{{lang.setting_disabled_by_admin}}</span>
                                        <div layout="row">
                                            <!-- Subscription SMS Switch -->
                                            <md-switch id="subscriptionsmsNotify" name="subscriptionsmsNotify"
                                                       ng-disabled="!ctrl.globalSetting.enableSMSNotification"
                                                       flex ng-model="ctrl.applicationUser.subscriptionsmsNotify"
                                                       aria-label="{{lang.subscription_sms}}">
                                                <label>{{lang.subscription_sms}} :
                                                    {{ctrl.applicationUser.getTranslatedYesNo('subscriptionsmsNotify')}}</label>
                                            </md-switch>
                                        </div>
                                        <div layout="row">
                                            <!-- New Item SMS -->
                                            <md-switch flex ng-model="ctrl.applicationUser.newsmsEmailNotify"
                                                       ng-disabled="!ctrl.globalSetting.enableSMSNotification"
                                                       ng-change="ctrl.resetNotificationsUserPreferences('newsmsEmailNotify','newItemSmspriority',[userPreferencesForm.newItemSmspriority])"
                                                       aria-label="{{lang.new_item_sms}}">
                                                <label>{{lang.new_item_sms}} :
                                                    {{ctrl.applicationUser.getTranslatedYesNo('newsmsEmailNotify')}}</label>
                                            </md-switch>
                                            <!-- New Item SMS Priority -->
                                            <md-input-container flex>
                                                <label for="newItemSmspriority">{{lang.new_item_sms_priority}}</label>
                                                <md-select multiple ng-required="ctrl.applicationUser.newsmsEmailNotify"
                                                           ng-disabled="!ctrl.globalSetting.enableSMSNotification || !ctrl.applicationUser.newsmsEmailNotify"
                                                           ng-readonly="!ctrl.applicationUser.newsmsEmailNotify"
                                                           name="newItemSmspriority" id="newItemSmspriority"
                                                           ng-model="ctrl.applicationUser.newItemSmspriority">
                                                    <md-option ng-value="priorityLevel"
                                                               ng-repeat="priorityLevel in ctrl.priorityLevels track by $index">
                                                        {{priorityLevel.getTranslatedName()}}
                                                    </md-option>
                                                </md-select>
                                                <div ng-messages="userPreferencesForm.newItemSmspriority.$error">
                                                    <div ng-message="required">{{lang.field_required}}</div>
                                                    <div ng-message="number">{{lang.numberonly}}</div>
                                                    <div ng-message="maxlength">{{lang.max_length.change({length:5})}}
                                                    </div>
                                                </div>
                                            </md-input-container>
                                        </div>
                                        <!-- Deadline SMS and Priority -->
                                        <div layout="row">
                                            <!-- Deadline SMS -->
                                            <md-switch flex ng-model="ctrl.applicationUser.deadlinesmsNotify"
                                                       ng-disabled="!ctrl.globalSetting.enableSMSNotification"
                                                       ng-change="ctrl.resetNotificationsUserPreferences('deadlinesmsNotify','deadlineSmspriority', [userPreferencesForm.deadlineSmspriority])"
                                                       aria-label="{{lang.deadline_sms}}">
                                                <label>{{lang.deadline_sms}} :
                                                    {{ctrl.applicationUser.getTranslatedYesNo('deadlinesmsNotify')}}</label>
                                            </md-switch>
                                            <!-- Deadline SMS Priority -->
                                            <md-input-container flex>
                                                <label for="deadlineSmspriority">{{lang.deadline_sms_priority}}</label>
                                                <md-select multiple ng-required="ctrl.applicationUser.deadlinesmsNotify"
                                                           ng-disabled="!ctrl.globalSetting.enableSMSNotification || !ctrl.applicationUser.deadlinesmsNotify"
                                                           ng-readonly="!ctrl.applicationUser.deadlinesmsNotify"
                                                           name="deadlineSmspriority" id="deadlineSmspriority"
                                                           ng-model="ctrl.applicationUser.deadlineSmspriority">
                                                    <md-option ng-value="priorityLevel"
                                                               ng-repeat="priorityLevel in ctrl.priorityLevels track by $index">
                                                        {{priorityLevel.getTranslatedName()}}
                                                    </md-option>
                                                </md-select>
                                                <div ng-messages="userPreferencesForm.deadlineSmspriority.$error">
                                                    <div ng-message="required">{{lang.field_required}}</div>
                                                    <div ng-message="number">{{lang.numberonly}}</div>
                                                    <div ng-message="maxlength">{{lang.max_length.change({length:5})}}
                                                    </div>
                                                </div>
                                            </md-input-container>
                                        </div>
                                        <!-- Reminder SMS, Priority and Days -->
                                        <div layout="row">
                                            <!-- Reminder SMS -->
                                            <md-switch flex ng-model="ctrl.applicationUser.reminderSmsnotify"
                                                       ng-disabled="!ctrl.globalSetting.enableSMSNotification"
                                                       ng-change="ctrl.resetNotificationsUserPreferences('reminderSmsnotify',['reminderSmsPriority', 'reminderSmsdays'], [userPreferencesForm.reminderSmsPriority, userPreferencesForm.reminderSmsdays])"
                                                       aria-label="{{lang.reminder_sms}}">
                                                <label>{{lang.reminder_sms}} :
                                                    {{ctrl.applicationUser.getTranslatedYesNo('reminderSmsnotify')}}</label>
                                            </md-switch>
                                            <!-- Reminder SMS Priority and Days -->
                                            <div layout="row" flex>
                                                <!-- Reminder SMS Priority -->
                                                <md-input-container flex>
                                                    <label for="reminderSmsPriority">{{lang.reminder_sms_priority}}</label>
                                                    <md-select multiple
                                                               ng-required="ctrl.applicationUser.reminderSmsnotify"
                                                               ng-disabled="!ctrl.globalSetting.enableSMSNotification || !ctrl.applicationUser.reminderSmsnotify"
                                                               ng-readonly="!ctrl.applicationUser.reminderSmsnotify"
                                                               name="reminderSmsPriority" id="reminderSmsPriority"
                                                               ng-model="ctrl.applicationUser.reminderSmsPriority">
                                                        <!--multiple ng-model-options="{trackBy: '$value.id'}"-->
                                                        <md-option ng-value="priorityLevel"
                                                                   ng-repeat="priorityLevel in ctrl.priorityLevels track by $index">
                                                            {{priorityLevel.getTranslatedName()}}
                                                        </md-option>
                                                    </md-select>
                                                    <div ng-messages="userPreferencesForm.reminderSmsPriority.$error">
                                                        <div ng-message="required">{{lang.field_required}}</div>
                                                        <div ng-message="number">{{lang.numberonly}}</div>
                                                        <div ng-message="maxlength">
                                                            {{lang.max_length.change({length:5})}}
                                                        </div>
                                                    </div>
                                                </md-input-container>
                                                <!-- Reminder SMS Days -->
                                                <md-input-container flex>
                                                    <label for="reminderSmsdays">{{lang.reminder_sms_days}}</label>
                                                    <input ng-required="ctrl.applicationUser.reminderSmsnotify"
                                                           ng-disabled="!ctrl.globalSetting.enableSMSNotification || !ctrl.applicationUser.reminderSmsnotify"
                                                           ng-readonly="!ctrl.applicationUser.reminderSmsnotify"
                                                           name="reminderSmsdays" id="reminderSmsdays"
                                                           ng-model="ctrl.applicationUser.reminderSmsdays" maxlength="5"
                                                           custom-validate-directive="number">
                                                    <div ng-messages="userPreferencesForm.reminderSmsdays.$error">
                                                        <div ng-message="required">{{lang.field_required}}</div>
                                                        <div ng-message="number">{{lang.numberonly}}</div>
                                                        <div ng-message="maxlength">
                                                            {{lang.max_length.change({length:5})}}
                                                        </div>
                                                    </div>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                                <!-- Email Notifications -->
                                <fieldset>
                                    <legend class="md-accent">
                                        {{lang.email_settings}}
                                    </legend>
                                    <div class="full-width-fieldset">
                                        <span class="red-text" ng-if="!ctrl.globalSetting.enableEmailNotification">{{lang.setting_disabled_by_admin}}</span>
                                        <div layout="row">
                                            <md-switch flex ng-model="ctrl.applicationUser.subscriptionEmailNotify"
                                                       ng-disabled="!ctrl.globalSetting.enableEmailNotification"
                                                       aria-label="{{lang.subscription_email}}">
                                                <label>{{lang.subscription_email}}</label>
                                            </md-switch>
                                        </div>
                                        <!-- New Item Email and Priority -->
                                        <div layout="row">
                                            <!-- New Item Email -->
                                            <md-switch flex ng-model="ctrl.applicationUser.newItemEmailNotify"
                                                       ng-disabled="!ctrl.globalSetting.enableEmailNotification"
                                                       ng-change="ctrl.resetNotificationsUserPreferences('newItemEmailNotify','newItemEmailPriority', [userPreferencesForm.newItemEmailPriority])"
                                                       aria-label="{{lang.new_item_email}}">
                                                <label>{{lang.new_item_email}} :
                                                    {{ctrl.applicationUser.getTranslatedYesNo('newItemEmailNotify')}}</label>
                                            </md-switch>
                                            <!-- New Item Email Priority -->
                                            <md-input-container flex>
                                                <label for="newItemEmailPriority">{{lang.new_item_email_priority}}</label>
                                                <md-select multiple
                                                           ng-required="ctrl.applicationUser.newItemEmailNotify"
                                                           ng-disabled="!ctrl.globalSetting.enableEmailNotification || !ctrl.applicationUser.newItemEmailNotify"
                                                           ng-readonly="!ctrl.applicationUser.newItemEmailNotify"
                                                           name="newItemEmailPriority" id="newItemEmailPriority"
                                                           ng-model="ctrl.applicationUser.newItemEmailPriority">
                                                    <!--multiple ng-model-options="{trackBy: '$value.id'}"-->
                                                    <md-option ng-value="priorityLevel"
                                                               ng-repeat="priorityLevel in ctrl.priorityLevels track by $index">
                                                        {{priorityLevel.getTranslatedName()}}
                                                    </md-option>
                                                </md-select>
                                                <div ng-messages="userPreferencesForm.newItemEmailPriority.$error">
                                                    <div ng-message="required">{{lang.field_required}}</div>
                                                    <div ng-message="number">{{lang.numberonly}}</div>
                                                    <div ng-message="maxlength">{{lang.max_length.change({length:5})}}
                                                    </div>
                                                </div>
                                            </md-input-container>
                                        </div>
                                        <!-- Deadline Email and Priority -->
                                        <div layout="row">
                                            <!-- Deadline Email -->
                                            <md-switch flex ng-model="ctrl.applicationUser.deadlineEmailNotify"
                                                       ng-disabled="!ctrl.globalSetting.enableEmailNotification"
                                                       ng-change="ctrl.resetNotificationsUserPreferences('deadlineEmailNotify','deadlineEmailPriority', [userPreferencesForm.deadlineEmailPriority])"
                                                       aria-label="{{lang.deadline_email}}">
                                                <label>{{lang.deadline_email}} :
                                                    {{ctrl.applicationUser.getTranslatedYesNo('deadlineEmailNotify')}}</label>
                                            </md-switch>
                                            <!-- Deadline Email Priority -->
                                            <md-input-container flex>
                                                <label for="deadlineEmailPriority">{{lang.deadline_email_priority}}</label>
                                                <md-select multiple
                                                           ng-required="ctrl.applicationUser.deadlineEmailNotify"
                                                           ng-disabled="!ctrl.globalSetting.enableEmailNotification || !ctrl.applicationUser.deadlineEmailNotify"
                                                           ng-readonly="!ctrl.applicationUser.deadlineEmailNotify"
                                                           name="deadlineEmailPriority" id="deadlineEmailPriority"
                                                           ng-model="ctrl.applicationUser.deadlineEmailPriority">
                                                    <md-option ng-value="priorityLevel"
                                                               ng-repeat="priorityLevel in ctrl.priorityLevels track by $index">
                                                        {{priorityLevel.getTranslatedName()}}
                                                    </md-option>
                                                </md-select>
                                                <div ng-messages="userPreferencesForm.deadlineEmailPriority.$error">
                                                    <div ng-message="required">{{lang.field_required}}</div>
                                                    <div ng-message="number">{{lang.numberonly}}</div>
                                                    <div ng-message="maxlength">{{lang.max_length.change({length:5})}}
                                                    </div>
                                                </div>
                                            </md-input-container>
                                        </div>
                                        <!-- Reminder Email, Priority and Days -->
                                        <div layout="row">
                                            <!-- Reminder Email -->
                                            <md-switch flex ng-model="ctrl.applicationUser.reminderEmailNotify"
                                                       ng-disabled="!ctrl.globalSetting.enableEmailNotification"
                                                       ng-change="ctrl.resetNotificationsUserPreferences('reminderEmailNotify',['reminderEmailPriority', 'reminderEmailDays'], [userPreferencesForm.reminderEmailPriority, userPreferencesForm.reminderEmailDays])"
                                                       aria-label="{{lang.reminder_email}}">
                                                <label>{{lang.reminder_email}} :
                                                    {{ctrl.applicationUser.getTranslatedYesNo('reminderEmailNotify')}}</label>
                                            </md-switch>
                                            <!-- Reminder Email Priority and Days-->
                                            <div layout="row" flex>
                                                <!-- Reminder Email Priority -->
                                                <md-input-container flex>
                                                    <label for="reminderEmailPriority">{{lang.reminder_email_priority}}</label>
                                                    <md-select multiple
                                                               ng-required="ctrl.applicationUser.reminderEmailNotify"
                                                               ng-disabled="!ctrl.globalSetting.enableEmailNotification || !ctrl.applicationUser.reminderEmailNotify"
                                                               ng-readonly="!ctrl.applicationUser.reminderEmailNotify"
                                                               name="reminderEmailPriority" id="reminderEmailPriority"
                                                               ng-model="ctrl.applicationUser.reminderEmailPriority">
                                                        <md-option ng-value="priorityLevel"
                                                                   ng-repeat="priorityLevel in ctrl.priorityLevels track by $index">
                                                            {{priorityLevel.getTranslatedName()}}
                                                        </md-option>
                                                    </md-select>
                                                    <div ng-messages="userPreferencesForm.reminderEmailPriority.$error">
                                                        <div ng-message="required">{{lang.field_required}}</div>
                                                        <div ng-message="number">{{lang.numberonly}}</div>
                                                        <div ng-message="maxlength">
                                                            {{lang.max_length.change({length:5})}}
                                                        </div>
                                                    </div>
                                                </md-input-container>
                                                <!-- Reminder Email Days -->
                                                <md-input-container flex>
                                                    <label for="reminderEmailDays">{{lang.reminder_email_days}}</label>
                                                    <input ng-required="ctrl.applicationUser.reminderEmailNotify"
                                                           ng-disabled="!ctrl.globalSetting.enableEmailNotification || !ctrl.applicationUser.reminderEmailNotify"
                                                           ng-readonly="!ctrl.applicationUser.reminderEmailNotify"
                                                           name="reminderEmailDays" id="reminderEmailDays"
                                                           ng-model="ctrl.applicationUser.reminderEmailDays"
                                                           maxlength="5"
                                                           custom-validate-directive="number">
                                                    <div ng-messages="userPreferencesForm.reminderEmailDays.$error">
                                                        <div ng-message="required">{{lang.field_required}}</div>
                                                        <div ng-message="number">{{lang.numberonly}}</div>
                                                        <div ng-message="maxlength">
                                                            {{lang.max_length.change({length:5})}}
                                                        </div>
                                                    </div>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        </md-content>
                    </md-tab>
                    <!-- Out Of Office Settings Tab -->
                    <md-tab label="{{lang.out_of_office_settings}}" ng-if="ctrl.showTab('outOfOfficeSettings')"
                            md-on-select="ctrl.setCurrentTab('outOfOfficeSettings')">
                        <md-content class="md-padding">
                            <ng-form name="outOfOfficeSettingsForm" autocomplete="off">
                                <div layout="column">
                                    <!-- Out of Office -->
                                    <fieldset>
                                        <legend class="md-accent">
                                            <!-- Determine Associate -->
                                            <md-switch flex ng-model="ctrl.isOutOfOffice"
                                                       ng-change="ctrl.changeOutOfOffice(outOfOfficeSettingsForm)"
                                                       aria-label="{{lang.out_of_office_toggle_button}}">
                                                <label>{{ctrl.isOutOfOffice ? (lang.out_of_office_settings + ' : ' +
                                                    lang.active) : (lang.out_of_office_settings + ' : ' + lang.inactive)
                                                    }}</label>
                                            </md-switch>
                                        </legend>
                                        <div class="full-width-fieldset">
                                            <div layout="row">
                                                <!-- Out Of Office -->
                                                <md-switch flex ng-model="ctrl.applicationUser.outOfOffice"
                                                           ng-disabled="!ctrl.isOutOfOffice"
                                                           aria-label="{{lang.out_of_office_toggle_button}}">
                                                    <label>{{ctrl.ouApplicationUser.getOutOffOfficeTranslatedStatus(ctrl.applicationUser.outOfOffice)}}</label>
                                                </md-switch>
                                            </div>
                                            <div layout="row">
                                                <!-- User On Behalf / Proxy User -->
                                                <!--<md-input-container flex>
                                                    <label>{{lang.user_on_behalf}}</label>
                                                    <md-select name="proxyUser" id="proxyUser"
                                                               ng-required="ctrl.isOutOfOffice"
                                                               ng-disabled="!ctrl.isOutOfOffice"
                                                               md-selected-text="ctrl.getSelectedDelegatedUserText()"
                                                               ng-model-options="{trackBy:'$value.id'}"
                                                               ng-model="ctrl.selectedProxyUser">
                                                        <md-option
                                                                ng-if="!ctrl.currentUser(proxyUser)"
                                                                ng-repeat="proxyUser in ctrl.availableProxies track by $index"
                                                                ng-value="proxyUser">
                                                            {{proxyUser.getTranslatedName()}}
                                                        </md-option>
                                                    </md-select>
                                                    <div ng-messages="outOfOfficeSettingsForm.proxyUser.$error">
                                                        <div ng-message="required">{{lang.field_required}}</div>
                                                    </div>
                                                </md-input-container>-->

                                                <!-- User On Behalf / Proxy User -->
                                                <md-autocomplete flex md-input-name="proxyUser" md-input-id="proxyUser"
                                                                 ng-required="ctrl.isOutOfOffice"
                                                                 ng-disabled="!ctrl.isOutOfOffice"
                                                                 md-no-cache="true"
                                                                 md-clear-button="true"
                                                                 md-selected-item="ctrl.selectedProxyUser"
                                                                 md-search-text-change="ctrl.proxyUserSearch(ctrl.searchTextProxyUser)"
                                                                 md-search-text="ctrl.searchTextProxyUser"
                                                                 md-selected-item-change="ctrl.selectedProxyUserChange(item)"
                                                                 md-items="item in ctrl.proxyUserSearch(ctrl.searchTextProxyUser)"
                                                                 md-item-text="item.getTranslatedName()"
                                                                 md-min-length="0"
                                                                 md-require-match
                                                                 md-floating-label="{{lang.user_on_behalf}}">
                                                    <md-item-template>
                                                        <span md-highlight-text="ctrl.searchTextProxyUser"
                                                              tooltip="{{item.getTranslatedName()}}"
                                                              md-highlight-flags="i">{{item.getTranslatedName()}}</span>
                                                    </md-item-template>
                                                    <md-not-found>
                                                        {{lang.no_records_found_matching_search}}
                                                    </md-not-found>
                                                    <div ng-messages="outOfOfficeSettingsForm.proxyUser.$error">
                                                        <div ng-message="required">{{lang.field_required}}</div>
                                                        <div ng-message="md-require-match">{{lang.field_required}}</div>
                                                    </div>
                                                </md-autocomplete>

                                                <!-- Authority Levels -->
                                                <md-input-container flex>
                                                    <label for="proxyAuthorityLevels">{{lang.authority_level}}</label>
                                                    <md-select multiple name="proxyAuthorityLevels"
                                                               ng-required="ctrl.isOutOfOffice && ctrl.filteredSecurityLevels.length"
                                                               ng-disabled="!ctrl.isOutOfOffice || !ctrl.filteredSecurityLevels.length"
                                                               id="proxyAuthorityLevels"
                                                               ng-model="ctrl.ouApplicationUser.proxyAuthorityLevels"
                                                               ng-model-options="{trackBy: '$value.id'}">
                                                        <md-option
                                                                ng-repeat="securityLevel in ctrl.filteredSecurityLevels track by $index"
                                                                ng-value="securityLevel">
                                                            {{securityLevel.getTranslatedName()}}
                                                        </md-option>
                                                    </md-select>
                                                    <div ng-messages="outOfOfficeSettingsForm.proxyAuthorityLevels.$error">
                                                        <div ng-message="required">{{lang.field_required}}</div>
                                                    </div>
                                                </md-input-container>
                                            </div>
                                            <div layout="row">
                                                <!-- Start Date -->
                                                <md-input-container flex class="cms-datepicker">
                                                    <label for="proxyStartDate">{{lang.start_date}}</label>
                                                    <md-datepicker id="proxyStartDate" name="proxyStartDate"
                                                                   ng-required="ctrl.isOutOfOffice && (ctrl.applicationUser.outOfOffice || ctrl.ouApplicationUser.proxyEndDate)"
                                                                   md-min-date="ctrl.today"
                                                                   ng-model="ctrl.ouApplicationUser.proxyStartDate"
                                                                   ng-change="ctrl.getMinProxyEndDate()"
                                                                   md-max-date="ctrl.calculatedMaxProxyStartDate"
                                                                   ng-disabled="!ctrl.isOutOfOffice"
                                                    ></md-datepicker>
                                                    <!--md-max-date="ctrl.ouApplicationUser.proxyEndDate"-->
                                                    <div ng-messages="outOfOfficeSettingsForm.proxyStartDate.$error">
                                                        <div ng-message="required">{{lang.field_required}}</div>
                                                    </div>
                                                </md-input-container>

                                                <!-- End Date -->
                                                <md-input-container flex class="cms-datepicker">
                                                    <label for="proxyEndDate">{{lang.end_date}}</label>
                                                    <md-datepicker id="proxyEndDate" name="proxyEndDate"
                                                                   ng-required="ctrl.isOutOfOffice && (ctrl.applicationUser.outOfOffice || ctrl.ouApplicationUser.proxyStartDate)"
                                                                   ng-model="ctrl.ouApplicationUser.proxyEndDate"
                                                                   md-min-date="ctrl.calculatedMinProxyEndDate"
                                                                   ng-change="ctrl.getMaxProxyStartDate()"
                                                                   ng-disabled="!ctrl.isOutOfOffice || !ctrl.ouApplicationUser.proxyStartDate"
                                                    ></md-datepicker>
                                                    <!--md-min-date="ctrl.ouApplicationUser.proxyStartDate"-->
                                                    <div ng-messages="outOfOfficeSettingsForm.proxyEndDate.$error">
                                                        <div ng-message="required">{{lang.field_required}}</div>
                                                    </div>
                                                </md-input-container>
                                            </div>
                                            <div layout="row">
                                                <!-- View Proxy Message -->
                                                <md-switch flex ng-model="ctrl.ouApplicationUser.viewProxyMessage"
                                                           aria-label="{{lang.view_message_to_sender}}"
                                                           ng-disabled="!ctrl.isOutOfOffice">
                                                    <label>{{lang.view_message_to_sender}} :
                                                        {{ctrl.ouApplicationUser.getTranslatedViewMessageToSender()}}</label>
                                                </md-switch>
                                                <!-- Out of office Message -->
                                                <md-input-container flex
                                                                    ng-if="ctrl.ouApplicationUser.viewProxyMessage">
                                                    <label for="proxyMessage">{{lang.out_of_office_message}}</label>
                                                    <textarea ng-model="ctrl.ouApplicationUser.proxyMessage"
                                                              name="proxyMessage" id="proxyMessage" minlength="2"
                                                              maxlength="265" required
                                                              ng-required="ctrl.ouApplicationUser.viewProxyMessage"
                                                              ng-disabled="!ctrl.isOutOfOffice">
                                            </textarea>
                                                    <div ng-messages="outOfOfficeSettingsForm.proxyMessage.$error">
                                                        <div ng-message="required">{{lang.field_required}}</div>
                                                        <div ng-message="minlength">{{lang.short}}</div>
                                                        <div ng-message="maxlength">
                                                            {{lang.max_length.change({length:300})}}
                                                        </div>
                                                    </div>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </fieldset>
                                </div>
                            </ng-form>
                        </md-content>
                    </md-tab>
                    <!-- User Comments Tab -->
                    <md-tab label="{{lang.user_comments}}" ng-if="ctrl.showTab('userComments')"
                            md-on-select="ctrl.setCurrentTab('userComments')">
                        <md-content class="md-padding">
                            <div layout="column">
                                <div layout="row" class="p20-0">
                                    <md-button ng-click="ctrl.openAddUserCommentDialog($event)"
                                               class="md-icon-button"
                                               tooltip="{{lang.add}}">
                                        <md-icon md-svg-icon="plus"></md-icon>
                                    </md-button>
                                    <md-button ng-click="ctrl.reloadUserComments()" class="md-icon-button"
                                               tooltip="{{lang.reload}}">
                                        <md-icon md-svg-icon="refresh"></md-icon>
                                    </md-button>
                                    <span flex></span>
                                    <grid-search-directive grid="ctrl.grid"></grid-search-directive>
                                </div>
                                <div layout="column" flex>
                                    <div scroll-directive>
                                        <md-card md-whiteframe="3" class="card-overlay">
                                            <md-table-container>
                                                <div flex scroll-directive>
                                                    <table md-table md-row-select="true"
                                                           multiple="true"
                                                           ng-model="ctrl.selectedUserComments"
                                                           md-progress="ctrl.grid.progress">
                                                        <thead md-head md-order="ctrl.grid.order"
                                                               md-on-reorder="ctrl.getSortedDataUserComments">
                                                        <tr md-row>
                                                            <th colspan="4" class="table-selector-header"
                                                                ng-if="ctrl.selectedUserComments.length"
                                                                md-column>
                                                                <div layout="row"
                                                                     layout-align="start center">
                                                                    <span>{{ctrl.selectedUserComments.length}} {{lang.items_selected}} </span>
                                                                    <span flex></span>
                                                                    <table-status-directive
                                                                            when-close="ctrl.changeStatusBulkUserComments"></table-status-directive>
                                                                    <md-button class="md-icon-button"
                                                                               ng-click="ctrl.removeBulkUserComments($event)">
                                                                        <md-icon
                                                                                md-svg-icon="delete"></md-icon>
                                                                    </md-button>
                                                                </div>
                                                            </th>
                                                            <th ng-if="!ctrl.selectedUserComments.length"
                                                                md-column
                                                                md-order-by="shortComment">
                                                                <span>{{lang.short_comment}}</span>
                                                            </th>
                                                            <!--<th ng-if="!ctrl.selectedUserComments.length" md-column-->
                                                            <!--md-order-by=""><span>{{lang.comment}}</span>-->
                                                            <!--</th>-->
                                                            <th ng-if="!ctrl.selectedUserComments.length"
                                                                md-column
                                                                md-order-by="status">
                                                                <span>{{lang.status}}</span>
                                                            </th>
                                                            <th ng-if="!ctrl.selectedUserComments.length"
                                                                md-column
                                                                md-order-by="itemOrder"><span>{{lang.item_order}}</span>
                                                            </th>
                                                            <th ng-if="!ctrl.selectedUserComments.length"
                                                                md-column
                                                                md-order-by=""><span>{{lang.actions}}</span>
                                                            </th>
                                                        </tr>
                                                        </thead>
                                                        <tbody md-body>
                                                        <tr md-select="userComment" md-row
                                                            ng-repeat="userComment in ctrl.userComments | limitTo: ctrl.grid.limit: ((ctrl.grid.page - 1) * ctrl.grid.limit) track by $index">
                                                            <td md-cell><a href=""
                                                                           ng-click="ctrl.showComment(userComment, $event)">{{userComment.shortComment}}</a>
                                                            </td>
                                                            <!--<td md-cell>{{userComment.comment}}</td>-->
                                                            <td md-cell>
                                                                <md-switch aria-label="{{lang.status}}"
                                                                           ng-model="userComment.status"
                                                                           ng-change="ctrl.changeStatusUserComment(userComment)"
                                                                           title="{{userComment.getTranslatedStatus()}}"></md-switch>
                                                            </td>
                                                            <td md-cell>{{userComment.itemOrder}}</td>
                                                            <td md-cell>
                                                                <div flex layout="row"
                                                                     layout-align="start center">
                                                                    <md-button class="md-icon-button"
                                                                               ng-click="ctrl.openEditUserCommentDialog(userComment, $event)"
                                                                               title="{{lang.edit}}">
                                                                        <md-icon
                                                                                md-svg-icon="pencil"></md-icon>
                                                                    </md-button>
                                                                    <md-button class="md-icon-button"
                                                                               ng-click="ctrl.removeUserComment(userComment, $event)"
                                                                               title="{{lang.delete}}">
                                                                        <md-icon
                                                                                md-svg-icon="delete"></md-icon>
                                                                    </md-button>

                                                                </div>
                                                            </td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <md-table-pagination
                                                        md-label="{page: '{{lang.page}}', rowsPerPage: '{{lang.rows_per_page}}', of: '{{lang.count_of}}'}"
                                                        md-limit-options="ctrl.grid.limitOptions"
                                                        md-limit="ctrl.grid.limit" md-page="ctrl.grid.page"
                                                        md-total="{{ctrl.userComments.length}}"
                                                        md-page-select></md-table-pagination>
                                            </md-table-container>
                                        </md-card>
                                    </div>
                                </div>
                            </div>
                        </md-content>
                    </md-tab>
                    <!-- Workflow Groups Tab -->
                    <md-tab label="{{lang.workflow_groups}}" ng-if="ctrl.showTab('workflowGroups')"
                            md-on-select="ctrl.setCurrentTab('workflowGroups')">
                        <md-content class="md-padding">
                            <div layout="column">
                                <div layout="row" class="p20-0">
                                    <md-button ng-click="ctrl.openAddWorkflowGroupDialog($event)" class="md-icon-button"
                                               tooltip="{{lang.add}}">
                                        <md-icon md-svg-icon="plus"></md-icon>
                                    </md-button>
                                    <md-button ng-click="ctrl.reloadUserWorkflowGroups()" class="md-icon-button"
                                               tooltip="{{lang.reload}}">
                                        <md-icon md-svg-icon="refresh"></md-icon>
                                    </md-button>
                                    <span flex></span>
                                    <grid-search-directive grid="ctrl.userWorkflowGrid"></grid-search-directive>
                                </div>
                                <div layout="column" flex ng-if="ctrl.userWorkflowGroups.length">
                                    <div scroll-directive>
                                        <md-card md-whiteframe="3" class="card-overlay">
                                            <md-table-container>
                                                <div flex scroll-directive>
                                                    <table md-table md-row-select="true"
                                                           multiple="true"
                                                           ng-model="ctrl.selectedUserWorkflowGroups"
                                                           md-progress="ctrl.userWorkflowGrid.progress">
                                                        <thead md-head md-order="ctrl.userWorkflowGrid.order"
                                                               md-on-reorder="ctrl.getSortedDataUserWorkflow">
                                                        <tr md-row>
                                                            <th colspan="4" class="table-selector-header"
                                                                ng-if="ctrl.selectedUserWorkflowGroups.length"
                                                                md-column>
                                                                <div layout="row" layout-align="start center">
                                                                    <span>{{ctrl.selectedUserWorkflowGroups.length}} {{lang.items_selected}} </span>
                                                                    <span flex></span>
                                                                    <table-status-directive
                                                                            when-close="ctrl.changeStatusBulkUserWorkflowGroups"></table-status-directive>
                                                                    <md-button class="md-icon-button"
                                                                               ng-click="ctrl.removeBulkUserWorkflowGroups($event)">
                                                                        <md-icon md-svg-icon="delete"></md-icon>
                                                                    </md-button>
                                                                </div>
                                                            </th>
                                                            <th ng-if="!ctrl.selectedUserWorkflowGroups.length"
                                                                md-column
                                                                md-order-by="wfgroup.arName">
                                                                <span>{{lang.arabic_name}}</span>
                                                            </th>
                                                            <th ng-if="!ctrl.selectedUserWorkflowGroups.length"
                                                                md-column
                                                                md-order-by="wfgroup.enName">
                                                                <span>{{lang.english_name}}</span>
                                                            </th>
                                                            <th ng-if="!ctrl.selectedUserWorkflowGroups.length"
                                                                md-column
                                                                md-order-by="wfgroup.status">
                                                                <span>{{lang.status}}</span>
                                                            </th>
                                                            <th ng-if="!ctrl.selectedUserWorkflowGroups.length"
                                                                md-column
                                                                md-order-by="wfgroup.itemOrder"><span>{{lang.item_order}}</span>
                                                            </th>
                                                        </tr>
                                                        </thead>
                                                        <tbody md-body>
                                                        <tr md-select="userWorkflowGroup" md-row
                                                            ng-repeat="userWorkflowGroup in ctrl.userWorkflowGroups | limitTo: ctrl.userWorkflowGrid.limit: ((ctrl.userWorkflowGrid.page - 1) * ctrl.userWorkflowGrid.limit)  track by $index">
                                                            <td md-cell>{{userWorkflowGroup.wfgroup.arName}}</td>
                                                            <td md-cell>{{userWorkflowGroup.wfgroup.enName}}</td>
                                                            <td md-cell>
                                                                <md-switch aria-label="{{lang.status}}"
                                                                           ng-model="userWorkflowGroup.wfgroup.status"
                                                                           ng-change="ctrl.changeStatusUserWorkflowGroup(userWorkflowGroup.wfgroup)"
                                                                           title="{{userWorkflowGroup.wfgroup.getTranslatedStatus()}}"></md-switch>
                                                            </td>
                                                            <td md-cell>{{userWorkflowGroup.wfgroup.itemOrder}}</td>
                                                            <td md-cell>
                                                                <div flex layout="row" layout-align="start center">
                                                                    <md-button class="md-icon-button"
                                                                               ng-click="ctrl.openEditWorkflowGroupDialog(userWorkflowGroup.wfgroup, $event)"
                                                                               title="{{lang.edit}}">
                                                                        <md-icon md-svg-icon="pencil"></md-icon>
                                                                    </md-button>
                                                                    <md-button class="md-icon-button"
                                                                               ng-click="ctrl.removeUserWorkflowGroup(userWorkflowGroup, userWorkflowGroup.wfgroup, $event)"
                                                                               title="{{lang.delete}}">
                                                                        <md-icon md-svg-icon="delete"></md-icon>
                                                                    </md-button>

                                                                </div>
                                                            </td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <md-table-pagination
                                                        md-label="{page: '{{lang.page}}', rowsPerPage: '{{lang.rows_per_page}}', of: '{{lang.count_of}}'}"
                                                        md-limit-options="ctrl.userWorkflowGrid.limitOptions"
                                                        md-limit="ctrl.userWorkflowGrid.limit"
                                                        md-page="ctrl.userWorkflowGrid.page"
                                                        md-total="{{ctrl.userWorkflowGroups.length}}"
                                                        md-page-select></md-table-pagination>
                                            </md-table-container>
                                        </md-card>
                                    </div>
                                </div>
                            </div>
                        </md-content>
                    </md-tab>
                    <!-- User Folders -->
                    <md-tab label="{{lang.folders}}" ng-if="ctrl.showTab('folders')"
                            md-on-select="ctrl.setCurrentTab('folders')">
                        <md-content class="md-padding">
                            <div>
                                <user-folders-tree-view-directive
                                        folders="ctrl.userFolderService.userFolders"
                                        current-node="ctrl.currentNode"
                                        allow-actions="true"
                                        add-root-folder="true">
                                </user-folders-tree-view-directive>
                            </div>
                        </md-content>
                    </md-tab>

                    <md-tab label="{{lang.followup_folders}}" ng-if="ctrl.showTab('followupFolders')"
                            md-on-select="ctrl.setCurrentTab('followupFolders')">
                        <md-content class="md-padding">
                            <div>
                                <user-folders-tree-view-directive
                                        followup="true"
                                        folders="ctrl.followupFolders"
                                        current-node="ctrl.currentNode"
                                        allow-actions="true"
                                        add-root-folder="true">
                                </user-folders-tree-view-directive>
                            </div>
                        </md-content>
                    </md-tab>
                    <!-- Signature -->
                    <md-tab label="{{lang.signature}}" ng-if="ctrl.showTab('signature')"
                            md-on-select="ctrl.setCurrentTab('signature')">
                        <md-content class="md-padding">
                            <div layout="column">
                                <ng-form layout="row" name="signatureForm">
                                    <div layout="column" flex>
                                        <div layout="row">
                                            <div>
                                                <label for="add-sign"
                                                       class="md-button md-raised alongside-input md-primary">
                                                        <span layout="row" layout-align="start center">
                                                            <md-icon md-svg-icon="upload"></md-icon>
                                                            <span>{{lang.upload_signature}}</span>
                                                        </span>
                                                    <input reset-after-change="true"
                                                           catch-upload-file-directive="ctrl.viewImage"
                                                           class="hide-import-file" type="file"
                                                           id="add-sign" name="add-sign">
                                                </label>
                                                <!--<div class="help-text-div">{{ctrl.imageDimensionsInfo}}</div>-->
                                            </div>
                                            <md-input-container flex ng-if="ctrl.enableAdd">
                                                <label for="docSubject">{{lang.subject}}</label>
                                                <input name="docSubject" id="docSubject" minlength="4"
                                                       ng-model="ctrl.signature.docSubject"
                                                       ng-required="true"
                                                       maxlength="80">
                                                <div ng-messages="signatureForm.docSubject.$error">
                                                    <div ng-message="required">{{lang.field_required}}</div>
                                                    <div ng-message="minlength">{{lang.short}}</div>
                                                    <div ng-message="maxlength">
                                                        {{lang.max_length.change({length:80})}}
                                                    </div>
                                                </div>
                                            </md-input-container>
                                            <md-input-container flex ng-if="ctrl.enableAdd">
                                                <label for="documentTitle">{{lang.title}}</label>
                                                <input name="documentTitle" id="documentTitle" minlength="4"
                                                       ng-model="ctrl.signature.documentTitle" required
                                                       maxlength="80">
                                                <div ng-messages="signatureForm.documentTitle.$error">
                                                    <div ng-message="required">{{lang.field_required}}</div>
                                                    <div ng-message="minlength">{{lang.short}}</div>
                                                    <div ng-message="maxlength">
                                                        {{lang.max_length.change({length:80})}}
                                                    </div>
                                                </div>
                                            </md-input-container>
                                        </div>
                                        <div layout="row" ng-if="ctrl.enableAdd">
                                            <div flex>
                                                <img name="fileUrl" id="fileUrl" ng-if="ctrl.fileUrl"
                                                     ng-src="{{ctrl.fileUrl}}"
                                                     class="upload-image" height="85" flex>
                                            </div>
                                            <div layout="row" class="p20">
                                                <md-button class="md-raised md-primary"
                                                           ng-disabled="signatureForm.$invalid"
                                                           ng-click="ctrl.addApplicationUserSignatureFromCtrl()">
                                                    {{lang.add}}
                                                </md-button>
                                                <md-button class="md-raised red-text"
                                                           ng-click="ctrl.closeApplicationUserSignatureFromCtrl()">
                                                    {{lang.close}}
                                                </md-button>
                                            </div>
                                        </div>
                                    </div>
                                </ng-form>

                                <div layout="row" ng-if="ctrl.applicationUser.signature.length">
                                    <md-card md-whiteframe="3" flex class="card-overlay">
                                        <md-table-container>
                                            <div flex scroll-directive>
                                                <table md-table md-row-select
                                                       ng-model="ctrl.selectedSignature"
                                                       md-progress="ctrl.signatureGrid.progress">
                                                    <thead md-head md-order="ctrl.signatureGrid.order"
                                                           md-on-reorder="ctrl.getSortedDataSignature">
                                                    <tr md-row>
                                                        <th colspan="5" ng-if="ctrl.selectedSignature.length"
                                                            md-column>
                                                            <div layout="row" layout-align="start center">
                                                                <span>{{ctrl.selectedSignature.length}} {{lang.items_selected}} </span>
                                                                <span flex></span>
                                                                <!--<md-button class="md-icon-button"
                                                                           ng-click="ctrl.removeBulkSignatures($event)">
                                                                    <md-icon md-svg-icon="delete"></md-icon>
                                                                </md-button>-->
                                                            </div>
                                                        </th>
                                                        <th ng-if="!ctrl.selectedSignature.length" md-column
                                                            md-order-by="docSubject">
                                                            <span>{{lang.subject}}</span>
                                                        </th>
                                                        <th ng-if="!ctrl.selectedSignature.length" md-column
                                                            md-order-by="documentTitle">
                                                            <span>{{lang.title}}</span>
                                                        </th>
                                                        <th ng-if="!ctrl.selectedSignature.length" md-column>
                                                            <span>{{lang.actions}}</span>
                                                        </th>
                                                    </tr>
                                                    </thead>
                                                    <tbody md-body>
                                                    <tr md-row
                                                        ng-repeat="signature in ctrl.applicationUser.signature | limitTo: ctrl.signatureGrid.limit: ((ctrl.signatureGrid.page - 1) * ctrl.signatureGrid.limit) track by $index">
                                                        <td md-cell>{{signature.docSubject}}</td>
                                                        <td md-cell>{{signature.documentTitle}}</td>
                                                        <td md-cell>
                                                            <div flex layout="row" layout-align="start center">
                                                                <md-button class="md-icon-button" title="{{lang.edit}}"
                                                                           ng-click="ctrl.editSignature(signature, $event)">
                                                                    <md-icon md-svg-icon="pencil"></md-icon>
                                                                </md-button>
                                                                <md-button class="md-icon-button"
                                                                           title="{{lang.delete}}"
                                                                           ng-click="ctrl.removeSignature(signature, $event)">
                                                                    <md-icon md-svg-icon="delete"></md-icon>
                                                                </md-button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <md-table-pagination
                                                    md-label="{page: '{{lang.page}}', rowsPerPage: '{{lang.rows_per_page}}', of: '{{lang.count_of}}'}"
                                                    md-limit-options="ctrl.signatureGrid.limitOptions"
                                                    md-limit="ctrl.signatureGrid.limit"
                                                    md-page="ctrl.signatureGrid.page"
                                                    md-total="{{ctrl.applicationUser.signature.length}}" md-page-select>
                                            </md-table-pagination>
                                        </md-table-container>
                                    </md-card>
                                </div>

                            </div>
                        </md-content>
                    </md-tab>
                    <!-- Predefined Actions -->
                    <md-tab label="{{lang.predefined_actions}}" ng-if="ctrl.showTab('predefinedActions')"
                            md-on-select="ctrl.setCurrentTab('predefinedActions')">
                        <md-content class="md-padding">
                            <div layout="column">
                                <div layout="row" class="p20-0">
                                    <md-button ng-click="ctrl.openAddPredefinedActionDialog($event)"
                                               class="md-icon-button"
                                               tooltip="{{lang.add}}">
                                        <md-icon md-svg-icon="plus"></md-icon>
                                    </md-button>
                                    <md-button ng-click="ctrl.reloadPredefinedActions()" class="md-icon-button"
                                               tooltip="{{lang.reload}}">
                                        <md-icon md-svg-icon="refresh"></md-icon>
                                    </md-button>
                                    <span flex></span>
                                    <grid-search-directive grid="ctrl.predefinedActionsGrid"></grid-search-directive>
                                </div>
                                <div layout="column" flex>
                                    <div scroll-directive>
                                        <md-card md-whiteframe="3" class="card-overlay">
                                            <md-table-container>
                                                <div flex scroll-directive>
                                                    <table md-table md-row-select="true"
                                                           multiple="true"
                                                           ng-model="ctrl.selectedPredefinedActions"
                                                           md-progress="ctrl.predefinedActionsGrid.progress">
                                                        <thead md-head md-order="ctrl.predefinedActionsGrid.order"
                                                               md-on-reorder="ctrl.getSortedDataPredefinedActions">
                                                        <tr md-row>
                                                            <th colspan="4" class="table-selector-header"
                                                                ng-if="ctrl.selectedPredefinedActions.length"
                                                                md-column>
                                                                <div layout="row" layout-align="start center">
                                                                    <span>{{ctrl.selectedPredefinedActions.length}} {{lang.items_selected}} </span>
                                                                    <span flex></span>
                                                                </div>
                                                            </th>
                                                            <th ng-if="!ctrl.selectedPredefinedActions.length"
                                                                md-column
                                                                md-order-by="arName"><span>{{lang.arabic_name}}</span>
                                                            </th>
                                                            <th ng-if="!ctrl.selectedPredefinedActions.length"
                                                                md-column
                                                                md-order-by="enName"><span>{{lang.english_name}}</span>
                                                            </th>
                                                            <th ng-if="!ctrl.selectedPredefinedActions.length"
                                                                md-column
                                                                md-order-by=""><span>{{lang.status}}</span>
                                                            </th>
                                                        </tr>
                                                        </thead>
                                                        <tbody md-body>
                                                        <tr md-select="record" md-row
                                                            ng-repeat="record in ctrl.predefinedActions | limitTo: ctrl.predefinedActionsGrid.limit: ((ctrl.predefinedActionsGrid.page - 1) * ctrl.predefinedActionsGrid.limit)  track by $index">
                                                            <td md-cell>{{record.arName}}</td>
                                                            <td md-cell>{{record.enName}}</td>
                                                            <td md-cell>
                                                                <md-switch aria-label="{{lang.status}}"
                                                                           ng-model="record.status"
                                                                           ng-change="ctrl.changeStatusPredefinedAction(record)"
                                                                           title="{{record.getTranslatedStatus()}}"></md-switch>
                                                            </td>
                                                            <td md-cell>
                                                                <div flex layout="row" layout-align="start center">
                                                                    <md-button class="md-icon-button"
                                                                               ng-click="ctrl.openEditPredefinedActionDialog(record, $event)"
                                                                               title="{{lang.edit}}">
                                                                        <md-icon md-svg-icon="pencil"></md-icon>
                                                                    </md-button>
                                                                    <md-button class="md-icon-button"
                                                                               ng-click="ctrl.removePredefinedAction(record, $event)"
                                                                               title="{{lang.delete}}">
                                                                        <md-icon md-svg-icon="delete"></md-icon>
                                                                    </md-button>

                                                                </div>
                                                            </td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <md-table-pagination
                                                        md-label="{page: '{{lang.page}}', rowsPerPage: '{{lang.rows_per_page}}', of: '{{lang.count_of}}'}"
                                                        md-limit-options="ctrl.predefinedActionsGrid.limitOptions"
                                                        md-limit="ctrl.predefinedActionsGrid.limit"
                                                        md-page="ctrl.predefinedActionsGrid.page"
                                                        md-total="{{ctrl.predefinedActions.length}}"
                                                        md-page-select></md-table-pagination>
                                            </md-table-container>
                                        </md-card>
                                    </div>
                                </div>
                            </div>
                        </md-content>
                    </md-tab>
                    <!-- Digital Certificates -->
                    <md-tab label="{{lang.digital_certificates}}" ng-if="ctrl.showTab('digitalCertificates')"
                            md-on-select="ctrl.setCurrentTab('digitalCertificates')">
                        <md-content class="md-padding">
                            <div layout="column">
                                <ng-form name="certificateForm">
                                    <fieldset ng-if="!ctrl.applicationUser.certificate">
                                        <legend class="md-accent">
                                            <div layout="row" layout-align="center center">
                                                <span>{{lang.digital_certificate}} :&nbsp;</span>
                                                <span>{{lang.generate}}</span>
                                                <span>&nbsp;&nbsp;</span>
                                                <md-switch
                                                        class="m0"
                                                        aria-label="{{lang.digital_certificate}}"
                                                        ng-change="ctrl.onChangeCertificateTypeUpload()"
                                                        ng-model="ctrl.certificateTypeUpload">
                                                </md-switch>
                                                <span>{{lang.upload}}</span>
                                            </div>
                                        </legend>
                                        <div class="full-width-fieldset">
                                            <div layout="row">
                                                <div class="position-relative" ng-if="ctrl.certificateTypeUpload">
                                                    <md-button class="md-raised">
                                                        <div>
                                                            <span><md-icon md-svg-icon="upload"></md-icon></span>
                                                            <span>{{lang.upload}}</span>
                                                        </div>
                                                    </md-button>
                                                    <input reset-after-change="true"
                                                           accept="{{ctrl.certificateExtensions}}"
                                                           catch-upload-file-directive="ctrl.handleUploadCertificate"
                                                           class="hide-import-file" type="file"
                                                           id="add-user-cert" name="add-user-cert">
                                                </div>
                                                <md-input-container flex>
                                                    <label for="pinCode">{{lang.pin}}</label>
                                                    <input name="pinCode" id="pinCode" type="password"
                                                           ng-model="ctrl.userCertificate.pinCode" required
                                                           custom-validate-directive="number">
                                                    <div ng-messages="certificateForm.pinCode.$error">
                                                        <div ng-message="required">{{lang.field_required}}</div>
                                                        <div ng-message="number">{{lang.numberonly}}</div>
                                                    </div>
                                                </md-input-container>
                                                <div>
                                                    <md-button class="md-raised md-primary"
                                                               ng-disabled="certificateForm.$invalid"
                                                               ng-click="ctrl.saveUserCertificate($event)">
                                                        {{lang.add}}
                                                    </md-button>
                                                    <md-button class="md-raised red-text"
                                                               ng-click="ctrl.clearUserCertificate($event)">
                                                        {{lang.clear}}
                                                    </md-button>
                                                </div>
                                            </div>
                                            <div ng-if="ctrl.attachedCertificate">
                                                <span>{{ctrl.attachedCertificate.name}}</span>
                                                <md-icon md-svg-icon="close" class="cursor-pointer red-text"
                                                         tooltip="{{lang.remove}}"
                                                         aria-label="{{lang.remove}}"
                                                         ng-click="ctrl.removeCertificateContent($event)">
                                                </md-icon>
                                            </div>
                                        </div>
                                    </fieldset>
                                </ng-form>

                                <div layout="row" ng-if="ctrl.applicationUser.certificate">
                                    <md-card md-whiteframe="3" flex class="card-overlay">
                                        <md-table-container>
                                            <div flex scroll-directive>
                                                <table md-table md-progress="ctrl.userCertificateGrid.progress">
                                                    <thead md-head>
                                                    <tr md-row>
                                                        <th md-column>
                                                            <span>{{lang.subject}}</span>
                                                        </th>
                                                    </tr>
                                                    </thead>
                                                    <tbody md-body>
                                                    <tr md-row>
                                                        <td md-cell>{{ctrl.applicationUser.certificate.docSubject}}</td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </md-table-container>
                                    </md-card>
                                </div>

                            </div>
                        </md-content>
                    </md-tab>
                </md-tabs>
            </form>
        </div>
    </md-dialog-content>
    <md-dialog-actions class="cms-dialog-actions">
        <md-button class="md-raised md-primary" ng-disabled="userPreferencesForm.$invalid"
                   ng-if="ctrl.selectedTab==='general' || ctrl.selectedTab==='notificationSettings'"
                   ng-click="ctrl.editApplicationUserFromCtrl()">{{lang.save}}
        </md-button>
        <md-button class="md-raised md-primary" ng-disabled="outOfOfficeSettingsForm.$invalid || !ctrl.isOutOfOffice"
                   ng-if="ctrl.selectedTab==='outOfOfficeSettings'"
                   ng-click="ctrl.saveOutOfOfficeSettingsFromCtrl()">{{lang.save}}
        </md-button>
        <md-button class="md-raised red-text" ng-click="ctrl.closeUserPreferencePopupFromCtrl()">
            {{lang.close}}
        </md-button>
    </md-dialog-actions>
</md-dialog>
