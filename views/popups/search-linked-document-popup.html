<md-dialog class="dialog-extend cms-tabs-dialog" layout="column"
           ng-class="{'cms-dialog-full-screen':ctrl.fullScreen}"
           ng-attr-aria-label="{{lang.document_search}}">
    <popup-toolbar-directive header-text="{{lang.document_search}}"></popup-toolbar-directive>
    <md-dialog-content scroll-directive flex>
        <div>
            <md-tabs md-selected="ctrl.selectedIndex" md-dynamic-height>
                <!-- Basic Info Tab -->
                <md-tab label="{{lang.search}}">
                    <md-content class="md-padding">
                        <div layout="column">
                            <div layout="row">
                                <md-input-container flex>
                                    <label for="docSubject">{{lang.linked_document_subject}}</label>
                                    <input type="text" id="docSubject" name="docSubject"
                                           ng-model="ctrl.correspondence.docSubject">
                                </md-input-container>
                                <md-input-container flex>
                                    <label for="docFullSerial">{{lang.linked_document_serial}}</label>
                                    <input type="text" id="docFullSerial" name="docFullSerial"
                                           ng-model="ctrl.correspondence.docFullSerial">
                                </md-input-container>
                                <md-input-container flex>
                                    <label for="docType">{{lang.linked_document_type}}</label>
                                    <md-select id="docType" ng-model="ctrl.searchType"
                                               ng-change="ctrl.changeDocumentClass()">
                                        <md-option ng-value="documentClass"
                                                   ng-repeat="documentClass in ctrl.documentClasses">
                                            {{documentClass.getTranslatedName()}}
                                        </md-option>
                                    </md-select>
                                </md-input-container>
                                <md-input-container flex
                                                    ng-if="ctrl.searchType.getStringKeyValue().toLowerCase() === 'incoming'">
                                    <label for="refDocNumber">{{lang.document_number}}</label>
                                    <input type="text" id="refDocNumber" name="refDocNumber"
                                           ng-model="ctrl.correspondence.refDocNumber">
                                </md-input-container>
                            </div>
                            <div layout="row">
                                <md-input-container flex>
                                    <label for="registryOU">{{lang.linked_document_organization}}</label>
                                    <md-select ng-disabled="ctrl.disableSelectedOrganization" id="registryOU"
                                               name="registryOU"
                                               ng-model="ctrl.correspondence.registryOU"
                                               md-on-close="ctrl.clearSearchText('linkedDocOu')"
                                               data-md-container-class="select-header-container sticky-search-bar">
                                        <md-select-header class="select-header">
                                            <input ng-model="ctrl.linkedDocOuSearchText"
                                                   ng-keydown="ctrl.handleSearchKeyDown($event, 'registryOU')"
                                                   placeholder="{{lang.search}}"
                                                   class="select-header-input">
                                        </md-select-header>
                                        <md-option ng-value="null">{{lang.none}}</md-option>
                                        <md-option
                                                ng-repeat="organization in ctrl.organizations | translatedNameFilter: ctrl.linkedDocOuSearchText"
                                                ng-value="organization.id" md-truncate>
                                            <span
                                                    md-highlight-text="ctrl.linkedDocOuSearchText"
                                                    md-highlight-flags="i">{{organization.getTranslatedName()}}</span>
                                        </md-option>
                                    </md-select>
                                </md-input-container>
                                <md-input-container flex>
                                    <label for="securityLevel">{{lang.linked_document_security_level}}</label>
                                    <md-select id="securityLevel" name="securityLevel"
                                               ng-model="ctrl.correspondence.securityLevel"
                                               ng-change="ctrl.onSecurityLevelChange()"
                                               ng-model-options="{trackBy: '$value.id'}">
                                        <md-option ng-value="null">{{lang.all}}</md-option>
                                        <md-option ng-value="securityLevel"
                                                   ng-repeat="securityLevel in ctrl.securityLevels">
                                            {{securityLevel.getTranslatedName()}}
                                        </md-option>
                                    </md-select>
                                </md-input-container>
                                <md-input-container flex>
                                    <label for="year">{{lang.linked_document_year}}</label>
                                    <md-select id="year" ng-model="ctrl.correspondence.year">
                                        <md-option ng-value="year" ng-repeat="year in ctrl.years()">{{year}}</md-option>
                                    </md-select>
                                </md-input-container>
                            </div>
                            <div layout="row">
                                <md-input-container flex>
                                    <label for="mainClassification">{{lang.linked_document_main_classification}}</label>
                                    <md-select name="mainClassification"
                                               id="mainClassification"
                                               ng-model="ctrl.correspondence.mainClassification"
                                               ng-model-options="{trackBy: '$value.id'}"
                                               ng-change="ctrl.onChangeMainClassification($event)"
                                               md-on-close="ctrl.clearSearchText('mainClassification')"
                                               data-md-container-class="select-header-container sticky-search-bar">
                                        <md-select-header class="select-header" layout="column">
                                            <div layout="row" flex class="size-100">
                                                <input ng-model="ctrl.mainClassificationSearchText"
                                                       ng-keydown="ctrl.handleSearchKeyDown($event, 'mainClassification')"
                                                       placeholder="{{lang.search}}"
                                                       class="select-header-input">
                                                <md-button ng-if="ctrl.mainClassificationSearchText"
                                                           ng-click="ctrl.loadMainClassificationRecords($event)"
                                                           class="select-header-icon md-icon-button"
                                                           tooltip="{{lang.load_more_records}}">
                                                    <md-icon md-svg-icon="magnify-plus"></md-icon>
                                                </md-button>
                                            </div>
                                            <div class="help-text-div" ng-if="ctrl.mainClassificationSearchText">
                                                {{lang.press_enter_to_load_more_records}}
                                            </div>
                                        </md-select-header>
                                        <md-option ng-value="null">{{lang.all}}</md-option>
                                        <md-option ng-value="classification.classification"
                                                   ng-repeat="classification in ctrl.classifications | translatedNameFilter: ctrl.mainClassificationSearchText:'getIdNameByLanguage':'classification'">
                                            <span
                                                    md-highlight-text="ctrl.mainClassificationSearchText"
                                                    md-highlight-flags="i">{{classification.classification.getIdNameByLanguage()}}</span>
                                        </md-option>
                                    </md-select>
                                </md-input-container>
                                <!-- Sub Classification-->
                                <md-input-container flex>
                                    <label for="subClassification">{{lang.linked_document_sub_classification}}</label>
                                    <md-select ng-disabled="!ctrl.correspondence.mainClassification"
                                               name="subClassification"
                                               id="subClassification"
                                               ng-model="ctrl.correspondence.subClassification"
                                               ng-model-options="{trackBy: '$value.id'}"
                                               md-on-close="ctrl.clearSearchText('subClassification')"
                                               data-md-container-class="select-header-container sticky-search-bar">
                                        <md-select-header class="select-header" layout="column">
                                            <div layout="row" flex class="size-100">
                                                <input ng-model="ctrl.subClassificationSearchText"
                                                       ng-keydown="ctrl.handleSearchKeyDown($event, 'subClassification')"
                                                       placeholder="{{lang.search}}"
                                                       class="select-header-input">
                                                <md-button ng-if="ctrl.subClassificationSearchText"
                                                           ng-click="ctrl.loadSubClassificationRecords($event)"
                                                           class="select-header-icon md-icon-button"
                                                           tooltip="{{lang.load_more_records}}">
                                                    <md-icon md-svg-icon="magnify-plus"></md-icon>
                                                </md-button>
                                            </div>
                                            <div class="help-text-div" ng-if="ctrl.subClassificationSearchText">
                                                {{lang.press_enter_to_load_more_records}}
                                            </div>
                                        </md-select-header>
                                        <md-option ng-value="classification"
                                                   ng-repeat="classification in ctrl.correspondence.mainClassification.children | translatedNameFilter: ctrl.subClassificationSearchText:'getIdNameByLanguage'">
                                            <span
                                                    md-highlight-text="ctrl.subClassificationSearchText"
                                                    md-highlight-flags="i">{{classification.getIdNameByLanguage()}}</span>
                                        </md-option>
                                    </md-select>
                                </md-input-container>
                                <!-- Document File -->
                                <md-input-container flex>
                                    <label for="fileId">{{lang.linked_document_file}}</label>
                                    <md-select name="fileId"
                                               id="fileId"
                                               ng-model="ctrl.correspondence.fileId"
                                               ng-model-options="{trackBy: '$value.id'}"
                                               md-on-close="ctrl.clearSearchText('documentFile')"
                                               data-md-container-class="select-header-container sticky-search-bar">
                                        <md-select-header class="select-header" layout="column">
                                            <div layout="row" flex class="size-100">
                                                <input ng-model="ctrl.documentFileSearchText"
                                                       ng-keydown="ctrl.handleSearchKeyDown($event, 'documentFile')"
                                                       placeholder="{{lang.search}}"
                                                       class="select-header-input">
                                                <md-button ng-if="ctrl.documentFileSearchText"
                                                           ng-click="ctrl.loadDocumentFilesRecords($event)"
                                                           class="select-header-icon md-icon-button"
                                                           tooltip="{{lang.load_more_records}}">
                                                    <md-icon md-svg-icon="magnify-plus"></md-icon>
                                                </md-button>
                                            </div>
                                            <div class="help-text-div" ng-if="ctrl.documentFileSearchText">
                                                {{lang.press_enter_to_load_more_records}}
                                            </div>
                                        </md-select-header>
                                        <md-option ng-value="null">{{lang.all}}</md-option>
                                        <md-option ng-value="file.file"
                                                   ng-repeat="file in ctrl.documentFiles | translatedNameFilter: ctrl.documentFileSearchText:null:'file'">
                                            <span
                                                    md-highlight-text="ctrl.documentFileSearchText"
                                                    md-highlight-flags="i">{{file.file.getTranslatedName()}}</span>
                                        </md-option>
                                    </md-select>
                                </md-input-container>
                            </div>
                            <div layout="row">
                                <md-input-container flex>
                                    <label for="fileCode">{{lang.linked_document_file_code}}</label>
                                    <input name="fileCode"
                                           id="fileCode"
                                           ng-model="ctrl.correspondence.fileCode">
                                </md-input-container>
                                <md-input-container flex>
                                    <label for="fileSerial">{{lang.linked_document_file_number}}</label>
                                    <input name="fileSerial"
                                           id="fileSerial"
                                           ng-model="ctrl.correspondence.fileSerial">
                                </md-input-container>
                            </div>
                        </div>
                    </md-content>
                </md-tab>
                <md-tab ng-disabled="!ctrl.correspondences.length"
                        label="{{ctrl.correspondences.length ? lang.linked_document_search_result + ' - ' + ctrl.correspondences.length : lang.linked_document_search_result }}">
                    <md-content class="md-padding">
                        <div layout="column">
                            <div layout="row" class="p020">
                                <span flex></span>
                                <md-switch aria-label="{{lang.truncate_subject}}"
                                           class="m0"
                                           ng-model="ctrl.grid.truncateSubject"
                                           ng-change="ctrl.grid.setTruncateSubject($event)">
                                    <span>{{lang.truncate_subject}} : </span>
                                    {{ctrl.grid.truncateSubject ? lang.yes : lang.no }}
                                </md-switch>
                            </div>
                            <md-card>
                                <md-table-container>
                                    <div flex scroll-directive>
                                        <table md-table md-row-select multiple="{{ctrl.multiSelect}}"
                                               ng-model="ctrl.selectedCorrespondences"
                                               md-progress="ctrl.grid.progress">
                                            <thead md-head md-order="ctrl.grid.order"
                                                   md-on-reorder="ctrl.getSortedData">
                                            <tr md-row>
                                                <th ng-if="ctrl.selectedCorrespondences.length" md-column
                                                    colspan="7">
                                                    <div layout="row" layout-align="start center">
                                                        <span>{{ctrl.selectedCorrespondences.length}} {{lang.items_selected}} </span>
                                                        <span flex></span>
                                                    </div>
                                                </th>
                                                <th ng-if="!ctrl.selectedCorrespondences.length" md-column>
                                                    <!-- Indicators -->
                                                </th>
                                                <th md-column ng-if="!ctrl.selectedCorrespondences.length"
                                                    md-order-by="docSubject">
                                                    <span>{{lang.subject}}</span>
                                                </th>
                                                <th md-column ng-if="!ctrl.selectedCorrespondences.length"
                                                    md-order-by="docFullSerial">
                                                    <span>{{lang.inbox_serial}}</span>
                                                </th>
                                                <th md-column ng-if="!ctrl.selectedCorrespondences.length"
                                                    md-order-by="priorityLevel">
                                                    <span>{{lang.priority_level}}</span>
                                                </th>
                                                <th md-column ng-if="!ctrl.selectedCorrespondences.length"
                                                    md-order-by="securityLevel">
                                                    <span>{{lang.security_level}}</span>
                                                </th>
                                                <th md-column ng-if="!ctrl.selectedCorrespondences.length"
                                                    md-order-by="docType">
                                                    <span>{{lang.label_document_type}}</span>
                                                </th>
                                                <th md-column ng-if="!ctrl.selectedCorrespondences.length"
                                                    md-order-by="createdBy">
                                                    <span>{{lang.creator}}</span>
                                                </th>
                                                <th md-column ng-if="!ctrl.selectedCorrespondences.length"
                                                    md-order-by="createdOn">
                                                    <span>{{lang.created_on}}</span>
                                                </th>
                                            </tr>
                                            </thead>
                                            <tbody md-body>
                                            <tr md-row md-select="correspondence" model="correspondence"
                                                selected-length="{{ctrl.selectedCorrespondences.length ? ctrl.selectedCorrespondences.length : 0}}"
                                                ng-repeat="correspondence in ctrl.correspondences | filter:ctrl.searchModel | limitTo: ctrl.grid.limit: ((ctrl.grid.page - 1) * ctrl.grid.limit) track by $index">
                                                <td md-cell class="indicator-td">
                                                    <span flex
                                                          ng-class="{'indicator-content': correspondence.securityLevelIndicator}">
                                                        <md-icon ng-if="correspondence.securityLevelIndicator"
                                                                 class="{{correspondence.securityLevelIndicator.class}}"
                                                                 md-svg-icon="{{correspondence.securityLevelIndicator.icon}}"
                                                                 tooltip="{{lang[correspondence.securityLevelIndicator.tooltip].change({name: correspondence.securityLevel.getTranslatedName()})}}"
                                                        ></md-icon>
                                                    </span>
                                                    <span flex
                                                          ng-class="{'indicator-content': correspondence.priorityLevelIndicator}">
                                                        <md-icon ng-if="correspondence.priorityLevelIndicator"
                                                                 class="{{correspondence.priorityLevelIndicator.class}}"
                                                                 md-svg-icon="{{correspondence.priorityLevelIndicator.icon}}"
                                                                 tooltip="{{lang[correspondence.priorityLevelIndicator.tooltip].change({name: correspondence.priorityLevel.getTranslatedName()})}}"
                                                        ></md-icon>
                                                    </span>
                                                    <span flex
                                                          ng-class="{'indicator-content': correspondence.attachmentsIndicator}">
                                                        <md-icon ng-if="correspondence.attachmentsIndicator"
                                                                 class="{{correspondence.attachmentsIndicator.class}}"
                                                                 md-svg-icon="{{correspondence.attachmentsIndicator.icon}}"
                                                                 tooltip="{{lang[correspondence.attachmentsIndicator.tooltip]}}"
                                                        ></md-icon>
                                                    </span>
                                                    <span flex
                                                          ng-class="{'indicator-content': correspondence.linkedDocsIndicator}">
                                                        <md-icon ng-if="correspondence.linkedDocsIndicator"
                                                                 class="{{correspondence.linkedDocsIndicator.class}}"
                                                                 md-svg-icon="{{correspondence.linkedDocsIndicator.icon}}"
                                                                 tooltip="{{lang[correspondence.linkedDocsIndicator.tooltip]}}"
                                                        ></md-icon>
                                                    </span>
                                                    <!--<span flex class="indicator-badge"
                                                          ng-class="{'indicator-content': correspondence.tagsIndicator}">
                                                        <span ng-if="correspondence.tagsIndicator"
                                                              tooltip="{{lang[correspondence.tagsIndicator.tooltip]}}"
                                                              class="{{correspondence.tagsIndicator.class}}">
                                                            {{correspondence.tagsIndicator.text}}
                                                        </span>
                                                    </span>-->
                                                </td>
                                                <!--<td md-cell class="td-data">
                                                    <a href="" ng-if="correspondence.hasContent()" class="view-doc"
                                                       ng-click="ctrl.viewCorrespondence(correspondence, $event)">{{correspondence.docSubject}}</a>
                                                    <span ng-if="!correspondence.hasContent()">{{correspondence.docSubject}}</span>
                                                </td>-->
                                                <td md-cell class="subject">
                                                    <a href=""
                                                       ng-if="correspondence.hasContent() && ctrl.grid.truncateSubject && ctrl.isViewCorrespondence"
                                                       class="view-doc subject-internal" md-truncate
                                                       tooltip="{{correspondence.docSubject}}"
                                                       ng-click="ctrl.viewCorrespondence(correspondence, $event)">{{correspondence.docSubject}}</a>
                                                    <span ng-if="(!correspondence.hasContent() || !ctrl.isViewCorrespondence) && ctrl.grid.truncateSubject"
                                                          class="view-doc subject-internal" md-truncate
                                                          tooltip="{{correspondence.docSubject}}">{{correspondence.docSubject}}</span>
                                                    <a href=""
                                                       ng-if="correspondence.hasContent() && !ctrl.grid.truncateSubject && ctrl.isViewCorrespondence"
                                                       class="view-doc subject-internal"
                                                       tooltip="{{correspondence.docSubject}}"
                                                       ng-click="ctrl.viewCorrespondence(correspondence, $event)">{{correspondence.docSubject}}</a>
                                                    <span ng-if="(!correspondence.hasContent() || !ctrl.isViewCorrespondence) && !ctrl.grid.truncateSubject"
                                                          class="view-doc subject-internal"
                                                          tooltip="{{correspondence.docSubject}}">{{correspondence.docSubject}}</span>
                                                </td>
                                                <td md-cell><span
                                                        class="serial-td">{{correspondence.docFullSerial}}</span></td>
                                                <td md-cell>{{correspondence.priorityLevel.getTranslatedName()}}</td>
                                                <td md-cell>{{correspondence.securityLevel.getTranslatedName()}}</td>
                                                <td md-cell>{{lang[correspondence.getInfo().documentClass
                                                    +"_document_class"]}}
                                                </td>
                                                <td md-cell>{{correspondence.getTranslatedCreator()}}</td>
                                                <td md-cell>{{correspondence.createdOn}}</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <md-table-pagination
                                            md-label="{page: '{{lang.page}}', rowsPerPage: '{{lang.rows_per_page}}', of: '{{lang.count_of}}'}"
                                            md-limit-options="ctrl.grid.limitOptions"
                                            md-limit="ctrl.grid.limit" md-page="ctrl.grid.page"
                                            md-total="{{ctrl.correspondences.length}}" md-page-select>
                                    </md-table-pagination>
                                </md-table-container>
                            </md-card>
                        </div>
                    </md-content>
                </md-tab>
            </md-tabs>
        </div>
    </md-dialog-content>
    <md-dialog-actions class="cms-dialog-actions">
        <md-button ng-if="ctrl.selectedIndex === 0 && !ctrl.selectedCorrespondences.length"
                   ng-click="ctrl.searchLinkedDocuments()"
                   class="md-raised md-primary"
                   ng-disabled="reason_form.$invalid && ctrl.itemNeedReason()">
            {{lang.linked_document_search_button}}
        </md-button>
        <md-button ng-if="ctrl.selectedCorrespondences.length" ng-click="ctrl.sendLinkedDocuments()"
                   class="md-raised md-primary">
            {{ctrl.isAdminSearch ? lang.action_submit : lang.linked_document_link_button}}
        </md-button>
        <md-button ng-click="ctrl.closeLinkedDocuments()" class="md-raised red-text">
            {{lang.close}}
        </md-button>
    </md-dialog-actions>
</md-dialog>
