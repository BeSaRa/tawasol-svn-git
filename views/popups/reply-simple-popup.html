<md-dialog class="dialog-extend"
           ng-class="{'cms-dialog-full-screen':ctrl.fullScreen}"
           aria-label="{{ctrl.dialogTitle}}">
    <div layout="column">
        <popup-toolbar-directive header-text="{{ctrl.dialogTitle}} - {{ctrl.record.getTranslatedName()}}"
                                 close-callback="ctrl.closeLaunchPopup"></popup-toolbar-directive>
        <md-content scroll-directive="">
            <div class="p20" layout="column">
                <form name="distWorkflowItem_form">
                    <div layout="row">
                        <!-- Reply To -->
                        <md-input-container flex>
                            <label for="to">{{lang.to}}</label>
                            <input id="to" ng-model="ctrl.replyToText" required
                                   ng-readonly="true" ng-disabled="true">
                            <div ng-messages="distWorkflowItem_form.to.$error">
                                <div ng-message="required">{{lang.field_required}}</div>
                            </div>
                        </md-input-container>
                        <!-- Managers -->
                        <md-input-container flex ng-if="ctrl.canSendToManagers">
                            <label for="managers">{{lang.managers}}</label>
                            <md-select multiple name="managers" id="managers"
                                       ng-model="ctrl.selectedManagers"
                                       ng-change="ctrl.resetNotifications()"
                                       md-selected-text="ctrl.getSelectedManagersText()"
                                       ng-model-options="{trackBy: '$value.id'}">
                                <md-option ng-value="manager" ng-repeat="manager in ctrl.managers">
                                    {{manager['ou' + ctrl.currentLangUCFirst + 'Name']}} - {{manager[lang.current + 'Name']}}
                                </md-option>
                            </md-select>
                            <div ng-messages="distWorkflowItem_form.managers.$error">
                                <div ng-message="required">{{lang.field_required}}</div>
                            </div>
                        </md-input-container>
                    </div>
                    <div layout="row">
                        <!-- Action -->
                        <md-input-container flex>
                            <label for="action">{{lang.select_action}}</label>
                            <md-select required id="action" ng-model-options="{trackBy:'$value.id'}" name="action"
                                       ng-model="ctrl.distWorkflowItem.action">
                                <md-option ng-value="action" ng-repeat="action in ctrl.workflowActions">
                                    {{action.getTranslatedName()}}
                                </md-option>
                            </md-select>
                            <div ng-messages="distWorkflowItem_form.action.$error">
                                <div ng-message="required">{{lang.field_required}}</div>
                            </div>
                        </md-input-container>
                        <!-- Due date -->
                        <md-input-container class="cms-datepicker" flex>
                            <label for="dueDate">{{lang.due_date}}</label>
                            <md-datepicker id="dueDate" md-open-on-focus
                                           md-min-date="ctrl.minDate"
                                           ng-model="ctrl.distWorkflowItem.dueDate"></md-datepicker>
                        </md-input-container>
                    </div>
                    <div ng-if="ctrl.globalSettings.enableEmailNotification || ctrl.globalSettings.enableSMSNotification"
                         layout="row">
                        <!-- SMS Notification -->
                        <div flex>
                            <md-checkbox ng-disabled="!ctrl.globalSettings.enableSMSNotification"
                                         ng-model="ctrl.distWorkflowItem.sendSMS">
                                {{lang.sms_workflow_notification}}
                            </md-checkbox>
                        </div>
                        <!-- Email Notification -->
                        <div flex>
                            <md-checkbox ng-disabled="!ctrl.globalSettings.enableEmailNotification"
                                         ng-model="ctrl.distWorkflowItem.sendEmail">
                                {{lang.email_workflow_notification}}
                            </md-checkbox>
                        </div>
                    </div>
                    <div layout="row">
                        <!-- Send Related Documents -->
                        <div flex
                             ng-if="ctrl.globalSettings.enableEmailNotification || ctrl.globalSettings.enableSMSNotification">
                            <md-checkbox ng-if="ctrl.globalSettings.allowSendWFRelatedBook"
                                         ng-model="ctrl.distWorkflowItem.sendRelatedDocs">
                                {{lang.send_related_documents}}
                            </md-checkbox>
                        </div>
                        <div flex>
                            <!-- Secure comment -->
                            <md-checkbox
                                    ng-model="ctrl.distWorkflowItem.isSecureAction"
                                    aria-label="{{lang.secure_action}}">
                                {{lang.secure_action}}
                            </md-checkbox>
                        </div>
                    </div>
                    <div layout="row">
                        <!-- Comment -->
                        <md-input-container flex>
                            <label for="comment">{{lang.select_comment}}</label>
                            <md-select id="comment" name="comment" ng-change="ctrl.onCommentChange()"
                                       ng-model="ctrl.comment">
                                <md-option ng-value="comment" ng-repeat="comment in ctrl.comments">
                                    {{comment.getCommentTitle()}}
                                </md-option>
                            </md-select>
                        </md-input-container>
                    </div>
                    <div layout="row">
                        <md-input-container flex>
                            <label for="comments"> {{lang.type_your_comment}}</label>
                            <textarea rows="5" id="comments" name="comments"
                                      ng-model="ctrl.distWorkflowItem.comments"
                                      ng-required="ctrl.distWorkflowItem.isSecureAction"></textarea>
                            <div ng-messages="distWorkflowItem_form.comments.$error">
                                <div ng-message="required">{{lang.field_required}}</div>
                            </div>
                        </md-input-container>
                    </div>
                </form>
            </div>
        </md-content>
        <div>
            <div layout="row">
                <div>
                    <md-button class="md-raised" ng-disabled="distWorkflowItem_form.$invalid"
                               ng-click="ctrl.launch($event)">
                        {{lang.reply}}
                    </md-button>
                </div>
                <span flex></span>
                <div>
                    <md-button class="md-raised" ng-click="ctrl.advancedReply($event)">{{lang.more_details}}
                    </md-button>
                </div>
                <span flex></span>
                <div>
                    <md-button class="md-raised" ng-click="ctrl.closeLaunchPopup()">{{lang.close}}
                    </md-button>
                </div>
            </div>
        </div>

    </div>
</md-dialog>
