<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link media="all" rel="stylesheet" href="print-grid-style.css">
</head>
<body>
<!--<h3 id="header"></h3>-->
<div id="headerDataContainer">
    <div class="row">
        <label class="subRow text-bold">{{lblSubject}}: </label>
        <label>{{txtSubject}}</label>
    </div>
    <div class="row">
        <label class="subRow text-bold">{{lblByUser}}: </label>
        <label>{{txtByUser}}</label>
    </div>
    <div class="row">
        <label class="subRow text-bold">{{lblCreationDate}}: </label>
        <label>{{txtCreationDate}}</label>
    </div>
</div>
<table id="userFollowupTable">

</table>

<script>
    (function () {
        var data = JSON.parse(localStorage.getItem('userFollowupData'));
        var columns = data.headerNames;
        var columnCount = columns.length;
        var records = data.data;
        var pageHeader = data.headerText;

        document.title = pageHeader.subject.value;
        var currentLang = localStorage.getItem('currentLang');
        var htmlTag = document.getElementsByTagName("html")[0];
        if (currentLang === 'ar') {
            htmlTag.classList.add('rtl');
            htmlTag.setAttribute('dir', 'rtl');
        } else {
            htmlTag.classList.remove('rtl');
            htmlTag.setAttribute('dir', 'ltr');
        }

        var headerDataContainer = document.getElementById('headerDataContainer');
        headerDataContainer.innerHTML = headerDataContainer.innerHTML
            .replace('{{lblSubject}}', pageHeader.subject.header)
            .replace('{{txtSubject}}', pageHeader.subject.value)
            .replace('{{lblByUser}}', pageHeader.byUser.header)
            .replace('{{txtByUser}}', pageHeader.byUser.value)
            .replace('{{lblCreationDate}}', pageHeader.creationDate.header)
            .replace('{{txtCreationDate}}', pageHeader.creationDate.value);

        function fillData() {
            return new Promise(function (resolve, reject) {
                var table = document.getElementById('userFollowupTable');

                //create header
                var tableHeader = table.createTHead();
                var rowHeader = tableHeader.insertRow(0);

                // loop through headers
                for (var i = 0; i < columnCount; i++) {
                    rowHeader.insertCell(i).innerHTML = columns[i];
                }

                var tableBody = table.createTBody();
                // loop through data
                for (var i = 0; i < records.length; i++) {
                    var record = records[i];
                    var row = tableBody.insertRow();
                    for (var j = 0; j < columnCount; j++) {
                        var cell = row.insertCell(j);
                        if (Array.isArray(record[j]) && record[j].length) {
                            var subtable = document.createElement("table");
                            for (var s = 0; s < record[j].length; s++) {
                                var subRow = subtable.insertRow();
                                var subCell = subRow.insertCell();
                                subCell.innerHTML = record[j][s] ? ('<div>' + record[j][s] + '</div>') : '';
                            }
                            cell.append(subtable);
                        } else {
                            cell.innerHTML = record[j] ? ('<div>' + record[j] + '</div>') : '';
                        }
                    }
                }
                localStorage.removeItem('userFollowupData');
                localStorage.removeItem('currentLang');
                resolve(true);
            });
        }

        fillData().then(function (value) {
            window.print()
        });
    })();
</script>
</body>
</html>
