<!-- start of view -->
<div background-directive="tall" class="page-content" flex="">
    <div layout="column" class="content">
        <!-- page-header start -->
        <div layout="row" layout-align="start center" class="page-header padding-header small">
            <md-button ng-click="ctrl.openSidebarFilter()" class="md-icon-button" tooltip="{{lang.reload}}">
                <md-icon md-svg-icon="menu"></md-icon>
            </md-button>
            <span>{{lang.menu_item_user_inbox}}</span>
            <md-button ng-click="ctrl.reloadUserInboxes()" class="md-icon-button" tooltip="{{lang.reload}}">
                <md-icon md-svg-icon="refresh"></md-icon>
            </md-button>
            <span flex></span>
            <md-button ng-click="ctrl.userFilterCreate($event)" class="md-icon-button" tooltip="{{lang.create_filter}}">
                <md-icon md-svg-icon="filter"></md-icon>
            </md-button>
            <search-filter-directive model="ctrl.searchModel"></search-filter-directive>
        </div>
        <!-- end page-header -->
        <!-- page-content -->
        <div layout="column" flex>
            <div class="z-index-3">
                <md-sidenav id="sidebar-folder-structure" md-is-open="ctrl.sidebarFilter"
                            ng-class="{'md-sidenav-right':lang.current === 'ar'}">
                    <div class="p20 first-folder-list" layout="column">
                        <p>{{lang.user_filters}}</p>
                        <folders-tree-structure-directive icon="filter-variant" disable-selected="0"
                                                          highlight-selected="ctrl.selectedFilter"
                                                          click-callback="ctrl.getFolderContent"
                                                          folders="ctrl.userFilters"></folders-tree-structure-directive>
                    </div>
                </md-sidenav>
            </div>
            <div scroll-directive>
                <div class="page-padding">
                    <md-card md-whiteframe="3" layout="column" class="card-overlay">
                        <div>
                            <md-tabs md-selected="ctrl.selectedTab" class="filter-tabs"
                                     md-dynamic-height>
                                <md-tab label="{{lang.inbox}}">
                                    <md-content class="white-bg">
                                        <work-item-inbox-directive
                                                grid="ctrl.grid"
                                                change-user-inbox-star-bulk="ctrl.changeUserInboxStarBulk"
                                                work-items="ctrl.userInboxes"
                                                view-document="ctrl.viewDocument"
                                                grid-actions="ctrl.gridActions"
                                                change-user-inbox-star="ctrl.changeUserInboxStar"
                                                forward-bulk="ctrl.forwardBulk"
                                                add-to-folder-user-inbox-bulk="ctrl.addToFolderUserInboxBulk"
                                                terminate-user-inbox-bulk="ctrl.terminateUserInboxBulk"
                                                mark-as-read-unread="ctrl.markAsReadUnread"
                                                check-if-forward-bulk-available="ctrl.checkIfForwardBulkAvailable"
                                                selected-work-items="ctrl.selectedUserInboxes">
                                        </work-item-inbox-directive>

                                        <!--<md-table-container>
                                            <div flex scroll-directive>
                                                <table md-table md-row-select multiple
                                                       ng-model="ctrl.selectedUserInboxes"
                                                       md-progress="ctrl.progress">
                                                    <thead md-head md-order="ctrl.grid.order">
                                                    <tr md-row>
                                                        <th colspan="{{ctrl.selectedUserInboxes.length > 1 ? 11 : 12}}"
                                                            ng-if="ctrl.selectedUserInboxes.length" md-column>
                                                            <div layout="row" layout-align="start center">
                                                                <span>{{ctrl.selectedUserInboxes.length}} {{lang.items_selected}} </span>
                                                                <span flex></span>

                                                                &lt;!&ndash;ng-if="ctrl.selectedUserInboxes.length > 1"&ndash;&gt;
                                                                <md-button class="md-icon-button"
                                                                           tooltip="{{lang.grid_action_forward}}"
                                                                           ng-if="ctrl.checkIfForwardBulkAvailable()"
                                                                           ng-click="ctrl.forwardBulk($event)">
                                                                    <md-icon md-svg-icon="share"
                                                                             class="action-green"></md-icon>
                                                                </md-button>
                                                                <md-button class="md-icon-button"
                                                                           aria-label="{{lang.inbox_terminate}}"
                                                                           tooltip="{{lang.inbox_terminate}}"
                                                                           ng-click="ctrl.terminateUserInboxBulk($event)">
                                                                    <md-icon md-svg-icon="stop"
                                                                             class="action-green"></md-icon>
                                                                </md-button>
                                                                <md-button class="md-icon-button"
                                                                           aria-label="{{lang.inbox_add_to_folder}}"
                                                                           tooltip="{{lang.inbox_add_to_folder}}"
                                                                           ng-click="ctrl.addToFolderUserInboxBulk($event)">
                                                                    <md-icon md-svg-icon="folder-plus"
                                                                             class="action-green"></md-icon>
                                                                </md-button>
                                                                <md-button class="md-icon-button action-green"
                                                                           aria-label="{{lang.star}}"
                                                                           tooltip="{{lang.star}}"
                                                                           ng-click="ctrl.changeUserInboxStarBulk('starBulk',$event)">
                                                                    <md-icon class="star-yellow"
                                                                             md-svg-icon="star"></md-icon>
                                                                </md-button>
                                                                <md-button class="md-icon-button action-green"
                                                                           aria-label="{{lang.un_star}}"
                                                                           tooltip="{{lang.un_star}}"
                                                                           ng-click="ctrl.changeUserInboxStarBulk('unStarBulk' ,$event)">
                                                                    <md-icon class="star-yellow"
                                                                             md-svg-icon="star-outline"></md-icon>
                                                                </md-button>
                                                            </div>
                                                        </th>
                                                        <th ng-if="!ctrl.selectedUserInboxes.length" md-column
                                                            md-order-by="">
                                                            &lt;!&ndash; Security Level, Document type, Tags, Re-assigned Indicators &ndash;&gt;
                                                        </th>
                                                        <th ng-if="!ctrl.selectedUserInboxes.length" md-column
                                                            md-order-by="">
                                                            &lt;!&ndash; Star/unstar &ndash;&gt;
                                                        </th>
                                                        <th ng-if="!ctrl.selectedUserInboxes.length" md-column
                                                            md-order-by="generalStepElm.docFullSerial">
                                                            <span>{{lang.inbox_serial}}</span>
                                                        </th>
                                                        <th ng-if="!ctrl.selectedUserInboxes.length" md-column
                                                            md-order-by="">
                                                            &lt;!&ndash; Priority Level and Has Attachment Indicators &ndash;&gt;
                                                        </th>
                                                        <th ng-if="!ctrl.selectedUserInboxes.length" md-column
                                                            md-order-by="generalStepElm.docSubject">
                                                            <span>{{lang.subject}}</span>
                                                        </th>
                                                        <th ng-if="!ctrl.selectedUserInboxes.length" md-column
                                                            md-order-by="generalStepElm.receivedDate">
                                                            <span>{{lang.received_date}}</span>
                                                        </th>
                                                        <th ng-if="!ctrl.selectedUserInboxes.length" md-column
                                                            md-order-by="action">
                                                            <span>{{lang.action}}</span>
                                                        </th>
                                                        <th ng-if="!ctrl.selectedUserInboxes.length" md-column
                                                            md-order-by="sender">
                                                            <span>{{lang.sender}}</span>
                                                        </th>
                                                        <th ng-if="!ctrl.selectedUserInboxes.length" md-column
                                                            md-order-by="generalStepElm.dueDate">
                                                            <span>{{lang.due_date}}</span>
                                                        </th>
                                                        <th ng-if="!ctrl.selectedUserInboxes.length" md-column
                                                            md-order-by="">
                                                            <span>{{lang.correspondence_sites}}</span>
                                                        </th>
                                                        &lt;!&ndash;<th ng-if="!ctrl.selectedUserInboxes.length" md-column md-order-by="docType">
                                                            <span>{{lang.type}}</span>
                                                        </th>
                                                        <th ng-if="!ctrl.selectedUserInboxes.length" md-column md-order-by="numberOfDays">
                                                            <span>{{lang.number_of_days}}</span>
                                                        </th>&ndash;&gt;
                                                        <th ng-if="!ctrl.selectedUserInboxes.length" md-column>
                                                            &lt;!&ndash; Grid Actions &ndash;&gt;
                                                        </th>
                                                        <th ng-if="!ctrl.selectedUserInboxes.length" md-column>
                                                            &lt;!&ndash; Read/Unread Indicator &ndash;&gt;
                                                        </th>
                                                    </tr>
                                                    </thead>
                                                    <tbody md-body>
                                                    <tr md-row md-select="userInbox"
                                                        grid-right-click-directive="userInbox"
                                                        model="userInbox"
                                                        ng-class="!userInbox.generalStepElm.isOpen? 'unread-row': 'read-row'"
                                                        selected-length="{{ctrl.selectedUserInboxes.length ? ctrl.selectedUserInboxes.length : 0}}"
                                                        ng-repeat="userInbox in ctrl.userInboxes | filter:ctrl.searchModel | limitTo: ctrl.grid.limit: ((ctrl.grid.page - 1) * ctrl.grid.limit) |orderBy:ctrl.grid.order  track by $index">
                                                        <td md-cell class="indicator-td">
                                                            &lt;!&ndash; Doc class &ndash;&gt;
                                                            <grid-indicator-directive record-type="WorkItem"
                                                                                      record="userInbox"
                                                                                      indicator-type="docClass">
                                                            </grid-indicator-directive>
                                                            &lt;!&ndash; Security Level &ndash;&gt;
                                                            <grid-indicator-directive record="userInbox"
                                                                                      indicator-type="securityLevel"
                                                                                      record-type="workItem"></grid-indicator-directive>
                                                            &lt;!&ndash; Electronic/Paper Document &ndash;&gt;
                                                            <grid-indicator-directive record="userInbox"
                                                                                      indicator-type="paperElectronic"
                                                                                      record-type="workItem"></grid-indicator-directive>
                                                            &lt;!&ndash; Is Reassigned &ndash;&gt;
                                                            <grid-indicator-directive record="userInbox"
                                                                                      indicator-type="isReassigned"
                                                                                      record-type="workItem"></grid-indicator-directive>
                                                            &lt;!&ndash; Linked Documents &ndash;&gt;
                                                            <grid-indicator-directive record="userInbox"
                                                                                      indicator-type="hasLinkedDocuments"
                                                                                      record-type="workItem"></grid-indicator-directive>
                                                            &lt;!&ndash; Follow up Status &ndash;&gt;
                                                            <grid-indicator-directive record="userInbox"
                                                                                      indicator-type="followupStatus"
                                                                                      record-type="workItem"></grid-indicator-directive>
                                                        </td>
                                                        <td md-cell>
                                                            <star-unstar-directive record="userInbox"
                                                                                   record-type="WorkItem"
                                                                                   callback="ctrl.changeUserInboxStar"
                                                                                   selected-records="ctrl.selectedUserInboxes"
                                                            ></star-unstar-directive>

                                                            &lt;!&ndash;
                                                                                                                        &lt;!&ndash;tooltip="{{userInbox.getTranslatedStarred()}}"&ndash;&gt;
                                                                                                                        <md-icon class="star-yellow cursor-pointer"
                                                                                                                                 aria-label="{{lang.starred}}"
                                                                                                                                 ng-if="userInbox.generalStepElm.starred && (!ctrl.selectedUserInboxes.length
                                                                                                                     || ctrl.selectedUserInboxes.length===1 && ctrl.selectedUserInboxes[0].generalStepElm.workObjectNumber === userInbox.generalStepElm.workObjectNumber)"
                                                                                                                                 md-svg-icon="star"
                                                                                                                                 ng-click="ctrl.changeUserInboxStar(userInbox, $event)"
                                                                                                                        ></md-icon>
                                                                                                                        &lt;!&ndash;tooltip="{{userInbox.getTranslatedStarred()}}"&ndash;&gt;
                                                                                                                        <md-icon class="star-yellow disabled"
                                                                                                                                 aria-label="{{lang.starred}}"
                                                                                                                                 ng-if="userInbox.generalStepElm.starred
                                                                                                                     && ((ctrl.selectedUserInboxes.length === 1
                                                                                                                     && ctrl.selectedUserInboxes[0].generalStepElm.workObjectNumber != userInbox.generalStepElm.workObjectNumber)
                                                                                                                        || ctrl.selectedUserInboxes.length > 1)"
                                                                                                                                 md-svg-icon="star"
                                                                                                                        ></md-icon>
                                                                                                                        &lt;!&ndash;tooltip="{{userInbox.getTranslatedStarred()}}"&ndash;&gt;
                                                                                                                        <md-icon class="star-yellow cursor-pointer"
                                                                                                                                 aria-label="{{lang.starred}}"
                                                                                                                                 ng-if="!userInbox.generalStepElm.starred && (!ctrl.selectedUserInboxes.length
                                                                                                                      || ctrl.selectedUserInboxes.length===1 && ctrl.selectedUserInboxes[0].generalStepElm.workObjectNumber === userInbox.generalStepElm.workObjectNumber)"
                                                                                                                                 md-svg-icon="star-outline"
                                                                                                                                 ng-click="ctrl.changeUserInboxStar(userInbox, $event)"
                                                                                                                        ></md-icon>
                                                                                                                        &lt;!&ndash;tooltip="{{userInbox.getTranslatedStarred()}}"&ndash;&gt;
                                                                                                                        <md-icon class="star-yellow disabled"
                                                                                                                                 aria-label="{{lang.starred}}"
                                                                                                                                 ng-if="!userInbox.generalStepElm.starred
                                                                                                                     && ((ctrl.selectedUserInboxes.length === 1
                                                                                                                     && ctrl.selectedUserInboxes[0].generalStepElm.workObjectNumber != userInbox.generalStepElm.workObjectNumber)
                                                                                                                        || ctrl.selectedUserInboxes.length > 1)"
                                                                                                                                 md-svg-icon="star-outline"
                                                                                                                        ></md-icon>&ndash;&gt;
                                                        </td>
                                                        <td md-cell>{{userInbox.generalStepElm.docFullSerial}}</td>
                                                        <td md-cell class="indicator-td text-right"
                                                            style="padding-right:0 !important; padding-left:0 !important;">
                                                            &lt;!&ndash; Priority Level &ndash;&gt;
                                                            <grid-indicator-directive record="userInbox"
                                                                                      indicator-type="priorityLevel"
                                                                                      record-type="workItem"></grid-indicator-directive>
                                                            &lt;!&ndash; Has Attachments &ndash;&gt;
                                                            <grid-indicator-directive record="userInbox"
                                                                                      span-class="float-right"
                                                                                      indicator-type="hasAttachment"
                                                                                      record-type="workItem"></grid-indicator-directive>
                                                        </td>
                                                        <td md-cell md-truncate class="subject">
                                                            <a href="" class="view-doc" md-truncate
                                                               ng-if="userInbox.hasContent()"
                                                               title="{{userInbox.generalStepElm.docSubject}}"
                                                               ng-click="ctrl.viewDocument(userInbox, $event)">{{userInbox.generalStepElm.docSubject}}</a>
                                                            <span ng-if="!userInbox.hasContent()"
                                                                  title="{{userInbox.generalStepElm.docSubject}}">{{userInbox.generalStepElm.docSubject}}</span>
                                                        </td>
                                                        <td md-cell>{{userInbox.getReceivedDate()}}</td>
                                                        <td md-cell>{{userInbox.action.getTranslatedName()}}</td>
                                                        <td md-cell class="td-data">
                                                            <div layout="row">
                                                                <span flex>{{userInbox.senderInfo.getTranslatedName()}}</span>
                                                            </div>
                                                        </td>
                                                        <td md-cell class="td-data">
                                            <span class="{{userInbox.dueDateStatusIndicator.class}}"
                                                  tooltip="{{lang[userInbox.dueDateStatusIndicator.tooltip].change({due_date_status:lang[userInbox.dueDateStatusIndicator.text] })}}">
                                                {{userInbox.generalStepElm.dueDate}}</span>
                                                        </td>
                                                        <td md-cell>
                                                            <main-site-sub-site-directive item="userInbox"
                                                                                          ng-if="userInbox.getInfo().documentClass!=='internal'">
                                                            </main-site-sub-site-directive>
                                                        </td>
                                                        &lt;!&ndash;<td md-cell>{{userInbox.generalStepElm.docType}}</td>
                                                        <td md-cell>{{userInbox.generalStepElm.numberOfDays}}</td>&ndash;&gt;
                                                        <td md-cell class="p-r0"
                                                            ng-if="ctrl.selectedUserInboxes.length < 2">
                                                            <div layout-align="start center" flex ng-if="!ctrl.selectedUserInboxes.length
                                                          || ctrl.selectedUserInboxes.length===1 && ctrl.selectedUserInboxes[0].generalStepElm.workObjectNumber === userInbox.generalStepElm.workObjectNumber">
                                                                <grid-actions-directive menu-direction="horizontal"
                                                                                        grid-actions="ctrl.gridActions"
                                                                                        model="userInbox"
                                                                                        shortcut="true">
                                                                </grid-actions-directive>
                                                            </div>
                                                        </td>
                                                        <td md-cell class="read-td">
                                                            <div class="cursor-pointer status"
                                                                 ng-class="userInbox.generalStepElm.isOpen===true? 'read' : 'unread'"
                                                                 ng-click="ctrl.markAsReadUnread(userInbox, $event)"
                                                                 ng-if="!ctrl.selectedUserInboxes.length
                                                          || ctrl.selectedUserInboxes.length===1 && ctrl.selectedUserInboxes[0].generalStepElm.workObjectNumber === userInbox.generalStepElm.workObjectNumber"
                                                                 tooltip="{{userInbox.generalStepElm.isOpen===true?lang.indicator_mark_unread: lang.indicator_mark_read}}"
                                                                 tooltip-direction="{{ctrl.langService.getCurrentLang() === 'en' ? 'left' : 'right'}}">
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <md-table-pagination
                                                    md-label="{page: '{{lang.page}}', rowsPerPage: '{{lang.rows_per_page}}', of: '{{lang.count_of}}'}"
                                                    md-limit-options="ctrl.grid.limitOptions"
                                                    md-limit="ctrl.grid.limit" md-page="ctrl.grid.page"
                                                    md-total="{{ctrl.userInboxes.length}}" md-page-select>
                                            </md-table-pagination>
                                        </md-table-container>-->
                                    </md-content>
                                </md-tab>
                                <md-tab ng-repeat="filter in ctrl.userFilters"
                                        md-on-select="ctrl.selectFilter(filter, $index)">
                                    <md-tab-label>
                                        <div layout="row" flex layout-align="start center">
                                            <div flex class="tab-title">{{filter.getTranslatedName()}}</div>
                                            <div class="filter-absolute">
                                                <md-menu-bar class="filter-menu">
                                                    <md-menu>
                                                        <md-button ng-click="$mdMenu.open()"
                                                                   class="md-icon-button filter-button">
                                                            <md-icon md-svg-icon="dots-vertical"></md-icon>
                                                        </md-button>
                                                        <md-menu-content width="2">
                                                            <md-menu-item>
                                                                <md-button
                                                                        ng-click="ctrl.userFilterEdit(filter , $index , $event)">
                                                                    <div layout="row">
                                                                        <md-icon md-svg-icon="pencil"></md-icon>
                                                                        <span flex>{{lang.edit_filter}}</span>
                                                                    </div>
                                                                </md-button>
                                                            </md-menu-item>
                                                            <md-menu-item>
                                                                <md-button
                                                                        ng-click="ctrl.userFilterDelete(filter , $index ,  $event)">
                                                                    <div layout="row">
                                                                        <md-icon md-svg-icon="delete"></md-icon>
                                                                        <span flex>{{lang.delete_filter}}</span>
                                                                    </div>
                                                                </md-button>
                                                            </md-menu-item>
                                                        </md-menu-content>
                                                    </md-menu>
                                                </md-menu-bar>
                                            </div>
                                        </div>
                                    </md-tab-label>
                                    <md-tab-body>
                                        <md-content class="white-bg">
                                            <work-item-inbox-directive
                                                    grid="ctrl.filterGrid[$index]"
                                                    change-user-inbox-star-bulk="ctrl.changeUserInboxStarBulk"
                                                    work-items="ctrl.workItemsFilters[$index]"
                                                    view-document="ctrl.viewDocument"
                                                    grid-actions="ctrl.gridActions"
                                                    change-user-inbox-star="ctrl.changeUserInboxStar"
                                                    forward-bulk="ctrl.forwardBulk"
                                                    add-to-folder-user-inbox-bulk="ctrl.addToFolderUserInboxBulk"
                                                    terminate-user-inbox-bulk="ctrl.terminateUserInboxBulk"
                                                    mark-as-read-unread="ctrl.markAsReadUnread"
                                                    check-if-forward-bulk-available="ctrl.checkIfForwardBulkAvailable"
                                                    selected-work-items="ctrl.selectedUserInboxes">
                                            </work-item-inbox-directive>
                                        </md-content>
                                    </md-tab-body>
                                </md-tab>
                            </md-tabs>
                        </div>
                    </md-card>
                </div>
            </div>
        </div>
        <!-- end page content -->
    </div>
</div>
<!-- end of view -->